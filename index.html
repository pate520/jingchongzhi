<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>盈利率预警系统 - 改进版原型</title>
  <!-- Element UI CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif;
      background-color: #f0f2f5;
      overflow: hidden;
    }
    /* 全局顶部导航 */
    .global-header {
      height: 60px;
      background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      padding: 0 30px;
      color: #fff;
    }
    .global-header-title {
      font-size: 20px;
      font-weight: bold;
      margin-right: 50px;
    }
    .global-nav {
      display: flex;
      gap: 5px;
    }
    .global-nav-item {
      padding: 8px 20px;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.3s;
      font-size: 14px;
    }
    .global-nav-item:hover {
      background-color: rgba(255,255,255,0.2);
    }
    .global-nav-item.active {
      background-color: rgba(255,255,255,0.3);
      font-weight: bold;
    }
    .layout-container {
      display: flex;
      height: calc(100vh - 60px);
    }
    /* 左侧菜单 */
    .sidebar {
      width: 200px;
      background-color: #304156;
      color: #fff;
      overflow-y: auto;
    }
    .sidebar-header {
      height: 50px;
      line-height: 50px;
      text-align: center;
      font-size: 16px;
      font-weight: bold;
      background-color: #1f2d3d;
      border-bottom: 1px solid #1f2d3d;
    }
    .menu-group {
      margin-top: 10px;
    }
    .menu-group-title {
      padding: 10px 20px;
      font-size: 12px;
      color: #8c939d;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .menu-group-title:hover {
      background-color: #263445;
    }
    .menu-item {
      padding: 12px 20px 12px 40px;
      font-size: 14px;
      color: #bfcbd9;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
    }
    .menu-item:hover {
      background-color: #263445;
      color: #fff;
    }
    .menu-item.active {
      background-color: #1890ff;
      color: #fff;
    }
    .menu-item i {
      margin-right: 8px;
      font-size: 16px;
    }
    .submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .submenu.open {
      max-height: 500px;
    }
    /* 主内容区 */
    .main-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }
    .page-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .page-title {
      font-size: 20px;
      font-weight: 500;
      color: #303133;
      margin-bottom: 20px;
      padding-left: 10px;
      border-left: 3px solid #1890ff;
    }
    /* 群组区域 */
    .group-section {
      margin-bottom: 40px;
    }
    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 0 10px 0;
      border-bottom: 2px solid #333;
      margin-bottom: 15px;
    }
    .group-title {
      font-size: 15px;
      font-weight: 600;
      color: #333;
    }
    .group-count {
      font-size: 13px;
      color: #909399;
      font-weight: normal;
    }
    /* 档位项 */
    .tier-item {
      padding: 0;
      margin-bottom: 18px;
    }
    .tier-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .tier-item-title {
      font-weight: 500;
      color: #303133;
      font-size: 14px;
    }
    .tier-divider {
      border: none;
      border-top: 1px solid #d9d9d9;
      margin: 8px 0;
    }
    .tier-info-row {
      display: grid;
      grid-template-columns: 140px 1fr 140px 1fr 140px 1fr 140px 1fr;
      gap: 10px 20px;
      margin-bottom: 8px;
      font-size: 13px;
      line-height: 1.6;
    }
    .tier-info-label {
      color: #606266;
    }
    .tier-info-value {
      color: #303133;
    }
    .tier-item-actions {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }
    /* 新增档位表单 */
    .add-tier-form {
      padding: 0;
      margin-bottom: 18px;
    }
    .add-tier-form-title {
      font-weight: 500;
      color: #303133;
      font-size: 14px;
      margin-bottom: 8px;
    }
    .add-tier-form-row {
      display: grid;
      grid-template-columns: 140px 1fr 140px 1fr 140px 1fr;
      gap: 10px 20px;
      margin-bottom: 8px;
      font-size: 13px;
      line-height: 1.6;
      align-items: center;
    }
    .form-group {
      display: contents;
    }
    .form-group label {
      color: #606266;
    }
    .form-group input,
    .form-group select {
      padding: 4px 8px;
      border: 1px solid #dcdfe6;
      border-radius: 3px;
      font-size: 13px;
      height: 28px;
    }
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #1890ff;
    }
    /* Tooltip 样式 */
    .label-with-tip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .tip-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background-color: #909399;
      color: white;
      font-size: 10px;
      cursor: help;
      position: relative;
    }
    .tip-icon:hover::after {
      content: attr(data-tip);
      position: absolute;
      left: 50%;
      bottom: 120%;
      transform: translateX(-50%);
      background-color: #303133;
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .tip-icon:hover::before {
      content: '';
      position: absolute;
      left: 50%;
      bottom: 110%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: #303133;
      z-index: 1000;
    }
    .add-tier-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    .add-tier-actions button {
      padding: 6px 16px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s;
    }
    .btn-save {
      background-color: #1890ff;
      color: #fff;
    }
    .btn-save:hover {
      background-color: #40a9ff;
    }
    .btn-cancel {
      background-color: #f5f7fa;
      color: #606266;
      border: 1px solid #dfe6ec;
    }
    .btn-cancel:hover {
      background-color: #e8eaed;
    }
    .btn-add {
      background-color: transparent;
      color: #606266;
      border: none;
      padding: 8px 0;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
      text-align: left;
    }
    .btn-add:hover {
      color: #1890ff;
    }
    .btn-edit, .btn-delete, .btn-view {
      padding: 0;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
      color: #1890ff;
      text-decoration: none;
    }
    .btn-edit:hover, .btn-view:hover {
      color: #40a9ff;
      text-decoration: underline;
    }
    .btn-delete {
      color: #f5222d;
    }
    .btn-delete:hover {
      color: #ff4d4f;
      text-decoration: underline;
    }
    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* 标签页内容样式 */
    .tab-content {
      flex: 1;
      overflow-y: auto;
      padding: 40px;
      background: #fff;
      width: 100%;
      height: calc(100vh - 60px);
    }
    .tab-content h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #303133;
    }
    .tab-content h2 {
      font-size: 18px;
      margin-top: 20px;
      margin-bottom: 15px;
      color: #606266;
    }
    .tab-content h3 {
      font-size: 16px;
      margin-top: 15px;
      margin-bottom: 10px;
      color: #909399;
    }
    .tab-content h4 {
      font-size: 14px;
      margin-top: 12px;
      margin-bottom: 8px;
      color: #909399;
    }
    .tab-content p {
      margin-bottom: 10px;
      line-height: 1.6;
      color: #606266;
    }
    .tab-content ul {
      margin-left: 20px;
      margin-bottom: 10px;
    }
    .tab-content li {
      margin-bottom: 8px;
      line-height: 1.6;
      color: #606266;
    }
    .tab-content pre {
      background-color: #f5f7fa;
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      margin-bottom: 10px;
      font-size: 12px;
      line-height: 1.5;
    }
    .tab-content table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    .tab-content table th,
    .tab-content table td {
      border: 1px solid #dfe6ec;
      padding: 10px;
      text-align: left;
    }
    .tab-content table th {
      background-color: #f5f7fa;
      font-weight: bold;
    }
    .tab-content hr {
      margin: 20px 0;
      border: none;
      border-top: 1px solid #dcdfe6;
    }
    .tab-content strong {
      font-weight: 600;
      color: #303133;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- 全局顶部导航 -->
    <div class="global-header">
      <div class="global-header-title">盈利率预警系统</div>
      <div class="global-nav">
        <div class="global-nav-item" :class="{ active: globalTab === 'prototype' }" @click="globalTab = 'prototype'">
          原型
        </div>
        <div class="global-nav-item" :class="{ active: globalTab === 'prd' }" @click="globalTab = 'prd'">
          产品文档
        </div>
        <div class="global-nav-item" :class="{ active: globalTab === 'frontend' }" @click="globalTab = 'frontend'">
          前端规范
        </div>
        <div class="global-nav-item" :class="{ active: globalTab === 'template' }" @click="globalTab = 'template'">
          群通知模板
        </div>
      </div>
    </div>

    <div class="layout-container" v-show="globalTab === 'prototype'">
      <!-- 左侧菜单 -->
      <div class="sidebar">
        <div class="sidebar-header">BITDU Admin</div>

        <!-- 风控管理 -->
        <div class="menu-group">
          <div class="menu-group-title" @click="toggleMenu('notify')">
            <span><i class="el-icon-message"></i> 风控管理</span>
            <i :class="menuOpen.notify ? 'el-icon-arrow-down' : 'el-icon-arrow-right'"></i>
          </div>
          <div class="submenu" :class="{ open: menuOpen.notify }">
            <div class="menu-item active">
              <i class="el-icon-setting"></i>
              净充值盈利率配置查询
            </div>
          </div>
        </div>
      </div>

      <!-- 主内容区 -->
      <div class="main-container">
        <div class="page-container">
          <h1 class="page-title">净充值盈利率配置查询</h1>

          <!-- 小额群组 -->
          <div class="group-section">
            <div class="group-header">
              <div class="group-title">小额净充值盈利预警群</div>
              <div class="group-count">共 {{ smallTiers.length }} 个档位</div>
            </div>

            <!-- 档位列表 -->
            <div v-for="tier in smallTiers" :key="tier.id" class="tier-item">
              <!-- 查看模式 -->
              <template v-if="editingTierId !== tier.id">
                <div class="tier-item-header">
                  <div class="tier-item-title">{{ tier.tierName }}</div>
                  <el-tag :type="tier.status === 1 ? 'success' : 'info'" size="small">
                    {{ tier.status === 1 ? '开启' : '关闭' }}
                  </el-tag>
                </div>
                <hr class="tier-divider">
                <div class="tier-info-row">
                  <span class="tier-info-label">净充值区间</span>
                  <span class="tier-info-value">{{ tier.minNetDeposit.toLocaleString() }} ~ {{ tier.maxNetDeposit.toLocaleString() }} USDT</span>
                  <span class="tier-info-label">预警盈利率</span>
                  <span class="tier-info-value">{{ tier.alertProfitRate.toLocaleString() }}%</span>
                  <span class="tier-info-label">触发次数</span>
                  <span class="tier-info-value">{{ tier.triggerCount }} 次</span>
                  <span class="tier-info-label">涉及用户</span>
                  <span class="tier-info-value">{{ tier.userCount }} 个</span>
                </div>
                <div class="tier-item-actions">
                  <button class="btn-view" @click="viewTriggerRecords(tier)">查看触发记录</button>
                  <button class="btn-edit" @click="editTier(tier)">编辑</button>
                  <button class="btn-delete" @click="deleteTier(tier)">删除</button>
                </div>
              </template>

              <!-- 编辑模式 -->
              <template v-else>
                <div class="add-tier-form-title">编辑档位</div>
                <hr class="tier-divider">
                <div class="add-tier-form-row">
                  <label>最小净充值（≥）</label>
                  <input v-model.number="newTierForm.minNetDeposit" type="number">
                  <label>最大净充值（<）</label>
                  <input v-model.number="newTierForm.maxNetDeposit" type="number">
                  <label class="label-with-tip">
                    <span>预警盈利率（%）</span>
                    <span class="tip-icon" data-tip="累计盈利 / 净充值&#10;净充值≤0时按1计算">❓</span>
                  </label>
                  <input v-model.number="newTierForm.alertProfitRate" type="number">
                </div>
                <div class="add-tier-form-row">
                  <label>状态</label>
                  <select v-model.number="newTierForm.status">
                    <option :value="1">开启</option>
                    <option :value="0">关闭</option>
                  </select>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
                <div class="add-tier-actions">
                  <button class="btn-save" @click="saveEdit">保存</button>
                  <button class="btn-cancel" @click="cancelEdit">取消</button>
                </div>
              </template>
            </div>

            <!-- 新增档位表单 -->
            <div v-if="addingGroupId === '1'" class="add-tier-form">
              <div class="add-tier-form-title">新增档位</div>
              <hr class="tier-divider">
              <div class="add-tier-form-row">
                <label>最小净充值（≥）</label>
                <input v-model.number="newTierForm.minNetDeposit" type="number" placeholder="如: -999999">
                <label>最大净充值（<）</label>
                <input v-model.number="newTierForm.maxNetDeposit" type="number" placeholder="如: 50">
                <label class="label-with-tip">
                  <span>预警盈利率（%）</span>
                  <span class="tip-icon" data-tip="累计盈利 / 净充值&#10;净充值≤0时按1计算">❓</span>
                </label>
                <input v-model.number="newTierForm.alertProfitRate" type="number" placeholder="如: 500">
              </div>
              <div class="add-tier-form-row">
                <label>状态</label>
                <select v-model.number="newTierForm.status">
                  <option :value="1">开启</option>
                  <option :value="0">关闭</option>
                </select>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
              </div>
              <div class="add-tier-actions">
                <button class="btn-save" @click="saveNewTier('1')">保存</button>
                <button class="btn-cancel" @click="cancelAddTier">取消</button>
              </div>
            </div>

            <!-- 新增按钮 -->
            <button v-else class="btn-add" @click="startAddTier('1')">➕ 新增档位</button>
          </div>

          <!-- 中额群组 -->
          <div class="group-section">
            <div class="group-header">
              <div class="group-title">中额净充值盈利预警群</div>
              <div class="group-count">共 {{ mediumTiers.length }} 个档位</div>
            </div>

            <!-- 档位列表 -->
            <div v-for="tier in mediumTiers" :key="tier.id" class="tier-item">
              <!-- 查看模式 -->
              <template v-if="editingTierId !== tier.id">
                <div class="tier-item-header">
                  <div class="tier-item-title">{{ tier.tierName }}</div>
                  <el-tag :type="tier.status === 1 ? 'success' : 'info'" size="small">
                    {{ tier.status === 1 ? '开启' : '关闭' }}
                  </el-tag>
                </div>
                <hr class="tier-divider">
                <div class="tier-info-row">
                  <span class="tier-info-label">净充值区间</span>
                  <span class="tier-info-value">{{ tier.minNetDeposit.toLocaleString() }} ~ {{ tier.maxNetDeposit.toLocaleString() }} USDT</span>
                  <span class="tier-info-label">预警盈利率</span>
                  <span class="tier-info-value">{{ tier.alertProfitRate.toLocaleString() }}%</span>
                  <span class="tier-info-label">触发次数</span>
                  <span class="tier-info-value">{{ tier.triggerCount }} 次</span>
                  <span class="tier-info-label">涉及用户</span>
                  <span class="tier-info-value">{{ tier.userCount }} 个</span>
                </div>
                <div class="tier-item-actions">
                  <button class="btn-view" @click="viewTriggerRecords(tier)">查看触发记录</button>
                  <button class="btn-edit" @click="editTier(tier)">编辑</button>
                  <button class="btn-delete" @click="deleteTier(tier)">删除</button>
                </div>
              </template>

              <!-- 编辑模式 -->
              <template v-else>
                <div class="add-tier-form-title">编辑档位</div>
                <hr class="tier-divider">
                <div class="add-tier-form-row">
                  <label>最小净充值（≥）</label>
                  <input v-model.number="newTierForm.minNetDeposit" type="number">
                  <label>最大净充值（<）</label>
                  <input v-model.number="newTierForm.maxNetDeposit" type="number">
                  <label class="label-with-tip">
                    <span>预警盈利率（%）</span>
                    <span class="tip-icon" data-tip="累计盈利 / 净充值&#10;净充值≤0时按1计算">❓</span>
                  </label>
                  <input v-model.number="newTierForm.alertProfitRate" type="number">
                </div>
                <div class="add-tier-form-row">
                  <label>状态</label>
                  <select v-model.number="newTierForm.status">
                    <option :value="1">开启</option>
                    <option :value="0">关闭</option>
                  </select>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
                <div class="add-tier-actions">
                  <button class="btn-save" @click="saveEdit">保存</button>
                  <button class="btn-cancel" @click="cancelEdit">取消</button>
                </div>
              </template>
            </div>

            <!-- 新增档位表单 -->
            <div v-if="addingGroupId === '2'" class="add-tier-form">
              <div class="add-tier-form-title">新增档位</div>
              <hr class="tier-divider">
              <div class="add-tier-form-row">
                <label>最小净充值（≥）</label>
                <input v-model.number="newTierForm.minNetDeposit" type="number" placeholder="如: 50">
                <label>最大净充值（<）</label>
                <input v-model.number="newTierForm.maxNetDeposit" type="number" placeholder="如: 100">
                <label class="label-with-tip">
                  <span>预警盈利率（%）</span>
                  <span class="tip-icon" data-tip="累计盈利 / 净充值&#10;净充值≤0时按1计算">❓</span>
                </label>
                <input v-model.number="newTierForm.alertProfitRate" type="number" placeholder="如: 450">
              </div>
              <div class="add-tier-form-row">
                <label>状态</label>
                <select v-model.number="newTierForm.status">
                  <option :value="1">开启</option>
                  <option :value="0">关闭</option>
                </select>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
              </div>
              <div class="add-tier-actions">
                <button class="btn-save" @click="saveNewTier('2')">保存</button>
                <button class="btn-cancel" @click="cancelAddTier">取消</button>
              </div>
            </div>

            <!-- 新增按钮 -->
            <button v-else class="btn-add" @click="startAddTier('2')">➕ 新增档位</button>
          </div>

          <!-- 大额群组 -->
          <div class="group-section">
            <div class="group-header">
              <div class="group-title">大额净充值盈利预警群</div>
              <div class="group-count">共 {{ largeTiers.length }} 个档位</div>
            </div>

            <!-- 档位列表 -->
            <div v-for="tier in largeTiers" :key="tier.id" class="tier-item">
              <!-- 查看模式 -->
              <template v-if="editingTierId !== tier.id">
                <div class="tier-item-header">
                  <div class="tier-item-title">{{ tier.tierName }}</div>
                  <el-tag :type="tier.status === 1 ? 'success' : 'info'" size="small">
                    {{ tier.status === 1 ? '开启' : '关闭' }}
                  </el-tag>
                </div>
                <hr class="tier-divider">
                <div class="tier-info-row">
                  <span class="tier-info-label">净充值区间</span>
                  <span class="tier-info-value">{{ tier.minNetDeposit.toLocaleString() }} ~ {{ tier.maxNetDeposit.toLocaleString() }} USDT</span>
                  <span class="tier-info-label">预警盈利率</span>
                  <span class="tier-info-value">{{ tier.alertProfitRate.toLocaleString() }}%</span>
                  <span class="tier-info-label">触发次数</span>
                  <span class="tier-info-value">{{ tier.triggerCount }} 次</span>
                  <span class="tier-info-label">涉及用户</span>
                  <span class="tier-info-value">{{ tier.userCount }} 个</span>
                </div>
                <div class="tier-item-actions">
                  <button class="btn-view" @click="viewTriggerRecords(tier)">查看触发记录</button>
                  <button class="btn-edit" @click="editTier(tier)">编辑</button>
                  <button class="btn-delete" @click="deleteTier(tier)">删除</button>
                </div>
              </template>

              <!-- 编辑模式 -->
              <template v-else>
                <div class="add-tier-form-title">编辑档位</div>
                <hr class="tier-divider">
                <div class="add-tier-form-row">
                  <label>最小净充值（≥）</label>
                  <input v-model.number="newTierForm.minNetDeposit" type="number">
                  <label>最大净充值（<）</label>
                  <input v-model.number="newTierForm.maxNetDeposit" type="number">
                  <label class="label-with-tip">
                    <span>预警盈利率（%）</span>
                    <span class="tip-icon" data-tip="累计盈利 / 净充值&#10;净充值≤0时按1计算">❓</span>
                  </label>
                  <input v-model.number="newTierForm.alertProfitRate" type="number">
                </div>
                <div class="add-tier-form-row">
                  <label>状态</label>
                  <select v-model.number="newTierForm.status">
                    <option :value="1">开启</option>
                    <option :value="0">关闭</option>
                  </select>
                  <span></span>
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
                <div class="add-tier-actions">
                  <button class="btn-save" @click="saveEdit">保存</button>
                  <button class="btn-cancel" @click="cancelEdit">取消</button>
                </div>
              </template>
            </div>

            <!-- 新增档位表单 -->
            <div v-if="addingGroupId === '3'" class="add-tier-form">
              <div class="add-tier-form-title">新增档位</div>
              <hr class="tier-divider">
              <div class="add-tier-form-row">
                <label>最小净充值（≥）</label>
                <input v-model.number="newTierForm.minNetDeposit" type="number" placeholder="如: 200">
                <label>最大净充值（<）</label>
                <input v-model.number="newTierForm.maxNetDeposit" type="number" placeholder="如: 500">
                <label class="label-with-tip">
                  <span>预警盈利率（%）</span>
                  <span class="tip-icon" data-tip="累计盈利 / 净充值&#10;净充值≤0时按1计算">❓</span>
                </label>
                <input v-model.number="newTierForm.alertProfitRate" type="number" placeholder="如: 350">
              </div>
              <div class="add-tier-form-row">
                <label>状态</label>
                <select v-model.number="newTierForm.status">
                  <option :value="1">开启</option>
                  <option :value="0">关闭</option>
                </select>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
              </div>
              <div class="add-tier-actions">
                <button class="btn-save" @click="saveNewTier('3')">保存</button>
                <button class="btn-cancel" @click="cancelAddTier">取消</button>
              </div>
            </div>

            <!-- 新增按钮 -->
            <button v-else class="btn-add" @click="startAddTier('3')">➕ 新增档位</button>
          </div>

        </div>
      </div>
    </div>

    <!-- 触发记录对话框 -->
    <el-dialog title="触发记录详情" :visible.sync="recordDialogVisible" width="95%" top="3vh">
      <div style="margin-bottom: 15px;">
        <strong>档位：</strong>{{ currentTier ? currentTier.tierName : '' }}
        <span style="margin-left: 20px;"><strong>触发次数：</strong>{{ currentTierRecords.length }} 次</span>
        <span style="margin-left: 20px;"><strong>涉及用户：</strong>{{ uniqueUserCount }} 个</span>
      </div>

      <!-- 筛选区域 -->
      <el-card shadow="never" style="margin-bottom: 15px; background-color: #fafafa;">
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; align-items: end;">
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #606266;">用户UID</label>
            <el-input v-model="filterForm.uid" placeholder="输入UID搜索" size="small" clearable></el-input>
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #606266;">盈利率范围(%)</label>
            <div style="display: flex; gap: 5px; align-items: center;">
              <el-input v-model.number="filterForm.minProfitRate" placeholder="最小" size="small" type="number" clearable></el-input>
              <span>~</span>
              <el-input v-model.number="filterForm.maxProfitRate" placeholder="最大" size="small" type="number" clearable></el-input>
            </div>
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #606266;">时间范围</label>
            <div style="display: flex; gap: 5px; align-items: center;">
              <el-date-picker v-model="filterForm.startDate" type="date" placeholder="开始日期" size="small" value-format="yyyy-MM-dd" style="width: 100%;"></el-date-picker>
              <span>~</span>
              <el-date-picker v-model="filterForm.endDate" type="date" placeholder="结束日期" size="small" value-format="yyyy-MM-dd" style="width: 100%;"></el-date-picker>
            </div>
          </div>
          <div style="display: flex; gap: 8px;">
            <el-button type="primary" size="small" icon="el-icon-search">搜索</el-button>
            <el-button size="small" icon="el-icon-refresh" @click="resetFilter">重置</el-button>
          </div>
        </div>
      </el-card>

      <el-table :data="pagedRecords" size="small" style="width: 100%" max-height="450" border>
        <el-table-column prop="uid" label="用户UID" min-width="100" sortable></el-table-column>
        <el-table-column prop="netDeposit" label="净充值(USDT)" min-width="120" align="right" sortable>
          <template slot-scope="scope">
            {{ scope.row.netDeposit.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) }}
          </template>
        </el-table-column>
        <el-table-column prop="maxNetDeposit" label="历史最高净充值(USDT)" min-width="160" align="right" sortable>
          <template slot-scope="scope">
            {{ scope.row.maxNetDeposit.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) }}
          </template>
        </el-table-column>
        <el-table-column prop="totalAssets" label="总资产(USDT)" min-width="120" align="right" sortable>
          <template slot-scope="scope">
            {{ scope.row.totalAssets.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) }}
          </template>
        </el-table-column>
        <el-table-column prop="totalProfit" label="累计盈利(USDT)" min-width="130" align="right" sortable>
          <template slot-scope="scope">
            {{ scope.row.totalProfit.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) }}
          </template>
        </el-table-column>
        <el-table-column prop="profitRate" label="盈利率(%)" min-width="110" align="right" sortable>
          <template slot-scope="scope">
            {{ scope.row.profitRate.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) }}%
          </template>
        </el-table-column>
        <el-table-column prop="alertTime" label="报警时间" min-width="150" sortable></el-table-column>
      </el-table>

      <!-- 分页 -->
      <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
        <div style="font-size: 13px; color: #606266;">
          共 {{ totalRecords }} 条记录，当前显示 {{ (currentPage - 1) * pageSize + 1 }}-{{ Math.min(currentPage * pageSize, totalRecords) }} 条
        </div>
        <el-pagination
          @size-change="handleSizeChange"
          @current-change="handlePageChange"
          :current-page="currentPage"
          :page-sizes="pageSizes"
          :page-size="pageSize"
          layout="sizes, prev, pager, next, jumper"
          :total="totalRecords">
        </el-pagination>
      </div>

      <div slot="footer" class="dialog-footer">
        <el-button @click="recordDialogVisible = false">关闭</el-button>
      </div>
    </el-dialog>

    <!-- 产品文档标签页 -->
    <div class="tab-content" v-show="globalTab === 'prd'">
      <!-- 这里将插入完整的产品文档内容 -->
      <h1>产品需求文档(PRD)</h1>
      <h2>净充值盈利率预警系统</h2>

      <h3>一、需求背景</h3>

      <p><strong>提出方</strong>: 市场部</p>
      <p><strong>需求描述</strong>: 需要在 Telegram 设立三个群组,分别监控小额、中额、大额净充值用户的盈利情况,当用户盈利率达到预设阈值时,自动向对应群组发送预警消息。</p>

      <p><strong>业务目标</strong>:</p>
      <ul>
        <li>实时监控高盈利用户,及时发现异常交易行为</li>
        <li>按净充值金额分层管理,提高监控效率</li>
        <li>按盈利率预警</li>
        <li>通过 Telegram 群组通知,便于团队协作处理</li>
      </ul>

      <hr>

      <h3>二、核心概念定义</h3>

      <h4>2.1 净充值</h4>
      <p>复用已有公式</p>

      <h4>2.2 历史最高净充值 ⭐ 新增字段</h4>
      <pre>
历史最高净充值 = 用户历史上净充值的最大值
</pre>

      <p><strong>更新时机</strong>:</p>
      <ul>
        <li>每次用户发生充值或提现行为时(包括链上充值、链上提现、法币入金等),重新计算当前净充值</li>
        <li>若当前净充值 > 历史最高净充值,则更新历史最高净充值</li>
        <li>该字段只增不减,记录用户曾经达到过的最高本金水平</li>
      </ul>


      <h4>2.3 总资产</h4>
      <p>复用已有公式</p>

      <h4>2.4 累计盈利</h4>
      <pre>
累计盈利 = 总资产 - 净充值
</pre>

      <p><strong>说明</strong>:</p>
      <ul>
        <li>当净充值为负数时,累计盈利 = 总资产 - 负数 = 总资产 + |净充值|</li>
      </ul>

      <h4>2.5 盈利率 ⭐ 核心公式</h4>

      <pre>
if (净充值 <= 0) {
    盈利率 = (累计盈利 / 1) × 100%
} else {
    盈利率 = (累计盈利 / 净充值) × 100%
}
</pre>

      <p><strong>边界情况处理</strong>:</p>
      <ul>
        <li>当 `净充值 <= 0` 时: <strong>统一按净充值 = 1 USDT 计算</strong></li>
      </ul>
      <hr>

      <h3>三、功能需求</h3>

      <h4>3.1 群组配置</h4>

      <p><strong>需求</strong>: 支持配置多个 Telegram 预警群组</p>

      <table>
        <tr>
          <th>字段</th>
          <th>说明</th>
          <th>示例</th>
        </tr>
        <tr>
          <td>群组名称</td>
          <td>群组的业务名称</td>
          <td>"小额净充值盈利预警群"</td>
        </tr>
        <tr>
          <td>通知类型标识</td>
          <td>系统内部标识</td>
          <td>"profit_alert_small"</td>
        </tr>
        <tr>
          <td>Telegram Webhook URL</td>
          <td>群组的机器人推送地址</td>
          <td>"https://api.telegram.org/bot..."</td>
        </tr>
        <tr>
          <td>状态</td>
          <td>启用/禁用</td>
          <td>启用</td>
        </tr>
      </table>

      <p><strong>固定配置</strong>:</p>
      <ul>
        <li>小额净充值盈利预警群</li>
        <li>中额净充值盈利预警群</li>
        <li>大额净充值盈利预警群</li>
      </ul>

      <p><strong>说明</strong>: 具体的净充值金额区间、盈利率阈值等参数,由市场部在 Admin 后台的"档位配置"中自行设定</p>

      <h4>3.2 档位配置</h4>

      <p><strong>需求</strong>: 每个群组可配置多个盈利率预警档位</p>

      <table>
        <tr>
          <th>字段</th>
          <th>说明</th>
          <th>示例</th>
          <th>必填</th>
        </tr>
        <tr>
          <td>所属群组</td>
          <td>关联的群组</td>
          <td>"小额净充值盈利预警群"</td>
          <td>是</td>
        </tr>
        <tr>
          <td>档位名称</td>
          <td>系统自动生成,格式: "群组简称 - 净充值区间"</td>
          <td>"小额 - 净充值1-50USDT"</td>
          <td>自动</td>
        </tr>
        <tr>
          <td>最小净充值</td>
          <td>净充值下限(USDT),可为负数</td>
          <td>1 或 -999999</td>
          <td>是</td>
        </tr>
        <tr>
          <td>最大净充值</td>
          <td>净充值上限(USDT)</td>
          <td>50</td>
          <td>是</td>
        </tr>
        <tr>
          <td>预警盈利率</td>
          <td>触发预警的盈利率(%)</td>
          <td>500</td>
          <td>是</td>
        </tr>
        <tr>
          <td>状态</td>
          <td>启用/禁用</td>
          <td>启用</td>
          <td>是</td>
        </tr>
      </table>

      <p><strong>档位名称生成规则</strong>:</p>
      <ul>
        <li>格式: `{群组简称} - 净充值{区间描述}`</li>
        <li>群组简称: "小额净充值盈利预警群" → "小额", "中额净充值盈利预警群" → "中额", "大额净充值盈利预警群" → "大额"</li>
        <li>区间描述:</li>
      </ul>
      <p>- 最小 ≤ 0 且 最大 = 0: "净充值≤0"</p>
      <p>- 其他情况: "净充值{最小}-{最大}USDT"</p>

      <p><strong>配置说明</strong>:</p>
      <ul>
        <li>每个群组可配置多个档位</li>
        <li>档位名称由系统自动生成,无需手动输入</li>
        <li>配置项: 所属群组、最小净充值、最大净充值、预警盈利率、状态</li>
      </ul>

      <h4>3.3 触发机制</h4>

      <p><strong>触发时机</strong>:</p>
      <ul>
        <li>用户<strong>合约平仓</strong>时</li>
        <li>用户<strong>现货卖出成交</strong>时</li>
      </ul>

      <p><strong>触发逻辑</strong>:</p>
      <p>1. 计算用户当前的净充值、总资产、累计盈利、盈利率</p>
      <p>3. 查找所有启用的档位配置</p>
      <p>4. 匹配用户净充值所在的档位区间</p>
      <p>5. 判断盈利率是否 >= 档位的预警盈利率</p>
      <p>6. 检查该用户在该档位当日是否已报警过(防重复)</p>
      <p>7. 若满足条件且未报警,则发送 Telegram 通知并记录</p>

      <p><strong>防重复机制</strong>:</p>
      <ul>
        <li>同一用户在同一档位每日只报警一次</li>
        <li>若用户净充值变化导致进入新档位,可再次报警</li>
        <li>通过 `profit_alert_record` 表记录已报警的用户+档位组合</li>
      </ul>

      <h4>3.4 Telegram 通知内容</h4>

      <p><strong>消息格式(正常用户)</strong>:</p>
      <pre>
⚠️ 盈利率预警 ⚠️

用户UID: 123456
档位: 小额 - 净充值1-50USDT

总充值: 100.00 USDT
总提现: 0.00 USDT
净充值: 100.00 USDT
历史最高净充值: 100.00 USDT
总资产: 500.00 USDT
累计盈利: 400.00 USDT
盈利率: 400.00%
触发时间: 2025-01-16 14:30:25

---
请及时关注该用户交易行为
</pre>

      <p><strong>消息格式(负净充值用户)</strong> ⚠️:</p>
      <pre>
⚠️⚠️ 盈利率预警 ⚠️⚠️

用户UID: 123456
档位: 小额 - 净充值≤0

总充值: 100.00 USDT
总提现: 550.00 USDT
净充值: -450.00 USDT
历史最高净充值: 500.00 USDT
总资产: 75.00 USDT
累计盈利: 525.00 USDT
盈利率: 52,500% (基于净充值1 USDT计算)
触发时间: 2025-01-16 14:30:25

---
请及时关注该用户交易行为
</pre>

      <h4>3.5 报警记录查询</h4>

      <p><strong>需求</strong>: Admin 后台可查询历史报警记录</p>

      <p><strong>查询条件</strong>:</p>
      <ul>
        <li>用户 UID</li>
        <li>报警时间范围</li>
        <li>盈利率范围</li>
        <li>净充值范围</li>
      </ul>

      <p><strong>列表字段</strong>:</p>
      <ul>
        <li>用户 UID</li>
        <li>净充值</li>
        <li>历史最高净充值</li>
        <li>总资产</li>
        <li>累计盈利</li>
        <li>盈利率</li>
        <li>报警时间</li>
      </ul>



      <hr>

      <h3>四、Admin 后台功能</h3>

      <h4>4.1 群组管理</h4>
      <ul>
        <li><strong>配置位置</strong>: 复用现有的"群组通知机器人管理"模块</li>
        <li><strong>数据表</strong>: `group_notify_bot` (群组通知机器人表,已存在)</li>
        <li><strong>列表页</strong>: 展示所有群组,支持启用/禁用</li>
        <li><strong>新增/编辑</strong>: 配置群组名称、通知类型、Telegram URL</li>
        <li><strong>删除</strong>: 删除群组(需确认,关联档位一并删除)</li>
      </ul>

      <h4>4.2 盈利率预警配置与查询（统一页面）</h4>

      <p><strong>设计理念</strong>: 将档位配置和触发记录查询合并到同一个页面，提升操作效率。</p>

      <ul>
        <li><strong>配置位置</strong>: Admin 后台"风控管理"菜单下新增"盈利率预警配置与查询"</li>
        <li><strong>数据表</strong>:
          <ul>
            <li>`profit_alert_tier` (盈利率预警档位表)</li>
            <li>`profit_alert_record` (盈利率预警记录表)</li>
          </ul>
        </li>
      </ul>

      <p><strong>页面布局</strong>:</p>
      <ul>
        <li><strong>三个群组卡片</strong>: 小额、中额、大额群组分别展示</li>
        <li><strong>档位列表</strong>: 每个群组下显示所有档位，按最小净充值从小到大排序</li>
        <li><strong>档位信息</strong>: 显示净充值区间、预警盈利率、触发次数、涉及用户数</li>
        <li><strong>内联编辑</strong>: 点击"编辑"后，档位信息直接切换为编辑表单，无需弹窗</li>
        <li><strong>触发记录</strong>: 点击"查看触发记录"打开对话框，显示该档位的详细触发记录</li>
      </ul>

      <p><strong>档位管理功能</strong>:</p>
      <ul>
        <li><strong>新增档位</strong>: 点击"➕ 新增档位"按钮，在下方展开表单
          <ul>
            <li>配置项: 最小净充值（≥）、最大净充值（<）、预警盈利率（%）、状态</li>
            <li>支持配置负数的最小净充值（如 -999999 表示无下限）</li>
            <li>示例: 最小净充值 = -999999, 最大净充值 = 0, 表示"净充值 ≤ 0"</li>
          </ul>
        </li>
        <li><strong>编辑档位</strong>: 点击"编辑"按钮，档位信息切换为编辑表单
          <ul>
            <li>可修改净充值区间、预警盈利率、状态</li>
            <li>保存后自动更新档位名称</li>
          </ul>
        </li>
        <li><strong>删除档位</strong>: 点击"删除"按钮，弹出确认对话框</li>
        <li><strong>校验规则</strong>:
          <ul>
            <li>最小净充值必须 < 最大净充值</li>
            <li>所有档位（包括不同群组）的净充值区间不能重叠</li>
            <li>重叠判断: <code>新档位最小值 < 已有档位最大值 && 已有档位最小值 < 新档位最大值</code></li>
            <li>如果重叠，提示"该区间与其他区间重叠"，拒绝保存</li>
          </ul>
        </li>
      </ul>

      <p><strong>触发记录查询功能</strong>:</p>
      <ul>
        <li><strong>入口</strong>: 点击档位的"查看触发记录"按钮</li>
        <li><strong>对话框</strong>: 95% 宽度，顶部距离 3vh</li>
        <li><strong>档位信息</strong>: 对话框顶部显示档位名称、触发次数、涉及用户数</li>
        <li><strong>筛选功能</strong>:
          <ul>
            <li>用户 UID（模糊搜索）</li>
            <li>盈利率范围（最小值~最大值）</li>
            <li>时间范围（开始日期~结束日期）</li>
            <li>搜索/重置按钮</li>
          </ul>
        </li>
        <li><strong>列表字段</strong>:
          <ul>
            <li>用户 UID</li>
            <li>净充值（USDT）</li>
            <li>历史最高净充值（USDT）</li>
            <li>总资产（USDT）</li>
            <li>累计盈利（USDT）</li>
            <li>盈利率（%）</li>
            <li>报警时间</li>
          </ul>
        </li>
        <li><strong>表格功能</strong>:
          <ul>
            <li>所有列支持点击排序</li>
            <li>数字格式化（千位分隔符）</li>
            <li>分页功能（10/20/50/100 条/页）</li>
          </ul>
        </li>
      </ul>

      <hr>

      <h3>五、业务规则</h3>

      <h4>5.1 档位匹配规则</h4>
      <ul>
        <li>用户净充值在 `[最小净充值, 最大净充值)` 区间内(左闭右开)</li>
      </ul>
      <p>- 即: <code>最小净充值 <= 用户净充值 < 最大净充值</code></p>
      <p>- 包含最小值,不包含最大值</p>
      <p>- 示例: 档位配置为 [50, 100),则 50 USDT 匹配,100 USDT 不匹配</p>
      <ul>
        <li><strong>所有档位(包括不同群组)的净充值区间不允许重叠</strong></li>
      </ul>
      <p>- 这确保了每个用户只会匹配到唯一一个档位</p>
      <p>- 不同群组之间通过净充值区间自然划分(小额、中额、大额)</p>
      <ul>
        <li><strong>特殊</strong>: 净充值 ≤ 0 的用户,归入"小额群组"的特殊档位</li>
      </ul>

      <h4>5.2 防重复规则</h4>
      <ul>
        <li>同一用户 + 同一档位,只报警一次(通过数据库唯一索引保证)</li>
        <li>若用户净充值变化,进入新档位,可再次报警</li>
        <li>若档位配置修改(如盈利率阈值降低),不会重新报警已报警用户</li>
      </ul>

      <h4>5.3 边界情况</h4>
      <ul>
        <li><strong>净充值 ≤ 0</strong>: 按 1 USDT 计算盈利率,盈利率会非常高(预期行为)</li>
        <li><strong>禁用状态的群组或档位</strong>: 不触发报警</li>
      </ul>


    </div>

    <!-- 前端规范标签页 -->
    <div class="tab-content" v-show="globalTab === 'frontend'">
      <!-- 这里将插入完整的前端规范内容 -->
      <h1>前端开发规范</h1>


      <h2>一、档位名称自动生成规则</h2>
      <h3>1. 生成逻辑</h3>
      <p>档位名称由系统自动生成,格式为: <strong>群组简称 - 净充值区间</strong></p>

      <h3>2. 群组简称映射</h3>
      <pre>const groupMap = {
  '1': '小额',
  '2': '中额',
  '3': '大额'
};</pre>

      <h3>3. 区间描述规则</h3>
      <pre>// 如果最小净充值 <= 0 且 最大净充值 = 0
区间描述 = "净充值≤0"

// 其他情况
区间描述 = "净充值{最小值}-{最大值}USDT"</pre>

      <p><strong>说明</strong>: 档位名称直接显示配置的最小值和最大值，不做任何简化处理。</p>

      <h3>4. 示例</h3>
      <ul>
        <li>最小=-999999, 最大=0 → "小额 - 净充值≤0"</li>
        <li>最小=0, 最大=50 → "小额 - 净充值0-50USDT"</li>
        <li>最小=50, 最大=100 → "中额 - 净充值50-100USDT"</li>
        <li>最小=200, 最大=500 → "大额 - 净充值200-500USDT"</li>
        <li>最小=500, 最大=999999 → "大额 - 净充值500-999999USDT"</li>
      </ul>

      <h3>5. 实现代码</h3>
      <pre>// 在新增或编辑档位时生成名称
const groupMap = { '1': '小额', '2': '中额', '3': '大额' };
const groupName = groupMap[groupId];
let rangeDesc = '';

if (this.newTierForm.minNetDeposit <= 0 && this.newTierForm.maxNetDeposit === 0) {
  rangeDesc = '净充值≤0';
} else {
  rangeDesc = `净充值${this.newTierForm.minNetDeposit}-${this.newTierForm.maxNetDeposit}USDT`;
}

const tierName = `${groupName} - ${rangeDesc}`;</pre>

      <h2>二、区间重叠校验规则</h2>
      <h3>1. 校验时机</h3>
      <p>在保存档位时(新增或编辑),必须校验净充值区间是否与已有档位重叠。</p>

      <h3>2. 校验范围</h3>
      <p><strong>重要</strong>: 必须校验所有档位(包括不同群组),不能只校验同一群组内的档位。</p>

      <h3>3. 重叠判断公式</h3>
      <pre>// 两个区间 [min1, max1) 和 [min2, max2) 重叠的条件:
min1 < max2 && min2 < max1</pre>

      <h3>4. 校验逻辑</h3>
      <pre>// 新增档位时的重叠校验
const overlapTier = this.tiers.find(tier => {
  // 跳过当前群组（新增时不需要跳过）
  return this.newTierForm.minNetDeposit < tier.maxNetDeposit &&
         tier.minNetDeposit < this.newTierForm.maxNetDeposit;
});

if (overlapTier) {
  this.$message.error('该区间与其他区间重叠');
  return;
}

// 编辑档位时的重叠校验
const overlapTier = this.tiers.find(tier => {
  // 跳过当前编辑的档位本身
  if (tier.id === this.editingTierId) return false;

  return this.newTierForm.minNetDeposit < tier.maxNetDeposit &&
         tier.minNetDeposit < this.newTierForm.maxNetDeposit;
});

if (overlapTier) {
  this.$message.error('该区间与其他区间重叠');
  return;
}</pre>

      <h3>5. 错误提示</h3>
      <p>统一使用: <strong>"该区间与其他区间重叠"</strong></p>

      <h2>三、表格排序规则</h2>
      <h3>1. 排序字段</h3>
      <p>按 <strong>最小净充值</strong> 字段排序</p>

      <h3>2. 排序方向</h3>
      <p>从小到大(升序),负数在前,正数在后</p>

      <h3>3. 实现方式</h3>
      <pre>computed: {
  sortedTableData() {
    return [...this.tableData].sort((a, b) =>
      a.minNetDeposit - b.minNetDeposit
    );
  }
}</pre>

      <h3>4. 排序示例</h3>
      <pre>原始数据:
- 档位A: 最小净充值 = 50
- 档位B: 最小净充值 = -999999
- 档位C: 最小净充值 = 100
- 档位D: 最小净充值 = 0

排序后:
1. 档位B: 最小净充值 = -999999
2. 档位D: 最小净充值 = 0
3. 档位A: 最小净充值 = 50
4. 档位C: 最小净充值 = 100</pre>

      <h2>四、表单校验规则</h2>
      <h3>1. 必填项校验</h3>
      <ul>
        <li>所属群组: 必选</li>
        <li>最小净充值: 必填,可为负数</li>
        <li>最大净充值: 必填</li>
        <li>预警盈利率: 必填,必须大于0</li>
      </ul>

      <h3>2. 数值校验</h3>
      <pre>// 最小净充值必须小于最大净充值
if (this.newTierForm.minNetDeposit >= this.newTierForm.maxNetDeposit) {
  this.$message.error('最小净充值必须小于最大净充值');
  return;
}</pre>

      <h3>3. 完整校验流程（新增档位）</h3>
      <pre>saveNewTier(groupId) {
  // 1. 必填项校验
  if (this.newTierForm.minNetDeposit === null || this.newTierForm.minNetDeposit === '') {
    this.$message.error('请填写最小净充值');
    return;
  }
  if (this.newTierForm.maxNetDeposit === null || this.newTierForm.maxNetDeposit === '') {
    this.$message.error('请填写最大净充值');
    return;
  }
  if (!this.newTierForm.alertProfitRate || this.newTierForm.alertProfitRate <= 0) {
    this.$message.error('请填写预警盈利率');
    return;
  }

  // 2. 数值校验
  if (this.newTierForm.minNetDeposit >= this.newTierForm.maxNetDeposit) {
    this.$message.error('最小净充值必须小于最大净充值');
    return;
  }

  // 3. 区间重叠校验
  const overlapTier = this.tiers.find(tier => {
    return this.newTierForm.minNetDeposit < tier.maxNetDeposit &&
           tier.minNetDeposit < this.newTierForm.maxNetDeposit;
  });

  if (overlapTier) {
    this.$message.error('该区间与其他区间重叠');
    return;
  }

  // 4. 生成档位名称并保存
  const groupMap = { '1': '小额', '2': '中额', '3': '大额' };
  const groupName = groupMap[groupId];
  let rangeDesc = '';
  if (this.newTierForm.minNetDeposit <= 0 && this.newTierForm.maxNetDeposit === 0) {
    rangeDesc = '净充值≤0';
  } else {
    rangeDesc = `净充值${this.newTierForm.minNetDeposit}-${this.newTierForm.maxNetDeposit}USDT`;
  }
  const tierName = `${groupName} - ${rangeDesc}`;

  // 添加到档位列表
  const newTier = {
    id: Math.max(...this.tiers.map(t => t.id), 0) + 1,
    groupId: groupId,
    tierName: tierName,
    minNetDeposit: this.newTierForm.minNetDeposit,
    maxNetDeposit: this.newTierForm.maxNetDeposit,
    alertProfitRate: this.newTierForm.alertProfitRate,
    status: this.newTierForm.status,
    triggerCount: 0,
    userCount: 0
  };

  this.tiers.push(newTier);
  this.$message.success('档位添加成功');

  // 关闭新增表单
  this.addingGroupId = null;
  this.newTierForm = { minNetDeposit: null, maxNetDeposit: null, alertProfitRate: null, status: 1 };
}</pre>

      <h3>4. 完整校验流程（编辑档位）</h3>
      <pre>saveEdit() {
  // 1. 必填项校验
  if (this.newTierForm.minNetDeposit === null || this.newTierForm.minNetDeposit === '') {
    this.$message.error('请填写最小净充值');
    return;
  }
  if (this.newTierForm.maxNetDeposit === null || this.newTierForm.maxNetDeposit === '') {
    this.$message.error('请填写最大净充值');
    return;
  }
  if (!this.newTierForm.alertProfitRate || this.newTierForm.alertProfitRate <= 0) {
    this.$message.error('请填写预警盈利率');
    return;
  }

  // 2. 数值校验
  if (this.newTierForm.minNetDeposit >= this.newTierForm.maxNetDeposit) {
    this.$message.error('最小净充值必须小于最大净充值');
    return;
  }

  // 3. 区间重叠校验（跳过当前编辑的档位）
  const overlapTier = this.tiers.find(tier => {
    if (tier.id === this.editingTierId) return false;
    return this.newTierForm.minNetDeposit < tier.maxNetDeposit &&
           tier.minNetDeposit < this.newTierForm.maxNetDeposit;
  });

  if (overlapTier) {
    this.$message.error('该区间与其他区间重叠');
    return;
  }

  // 4. 更新档位信息
  const tier = this.tiers.find(t => t.id === this.editingTierId);
  const groupMap = { '1': '小额', '2': '中额', '3': '大额' };
  const groupName = groupMap[tier.groupId];
  let rangeDesc = '';
  if (this.newTierForm.minNetDeposit <= 0 && this.newTierForm.maxNetDeposit === 0) {
    rangeDesc = '净充值≤0';
  } else {
    rangeDesc = `净充值${this.newTierForm.minNetDeposit}-${this.newTierForm.maxNetDeposit}USDT`;
  }
  const tierName = `${groupName} - ${rangeDesc}`;

  tier.tierName = tierName;
  tier.minNetDeposit = this.newTierForm.minNetDeposit;
  tier.maxNetDeposit = this.newTierForm.maxNetDeposit;
  tier.alertProfitRate = this.newTierForm.alertProfitRate;
  tier.status = this.newTierForm.status;

  this.$message.success('档位更新成功');

  // 退出编辑模式
  this.editingTierId = null;
  this.newTierForm = { minNetDeposit: null, maxNetDeposit: null, alertProfitRate: null, status: 1 };
}</pre>

    </div>

    <!-- 群通知模板标签页 -->
    <div class="tab-content" v-show="globalTab === 'template'">
      <!-- 这里将插入完整的群通知模板内容 -->
      <h1>Telegram 通知内容</h1>

      <h2>消息格式(正常用户)</h2>
      <pre>⚠️ 盈利率预警 ⚠️

用户UID: 123456
档位: 小额 - 净充值1-50USDT

总充值: 100.00 USDT
总提现: 0.00 USDT
净充值: 100.00 USDT
历史最高净充值: 100.00 USDT
总资产: 500.00 USDT
累计盈利: 400.00 USDT
盈利率: 400.00%
触发时间: 2025-01-16 14:30:25

---
请及时关注该用户交易行为</pre>

      <h2>消息格式(负净充值用户) ⚠️</h2>
      <pre>⚠️⚠️ 盈利率预警 ⚠️⚠️

用户UID: 123456
档位: 小额 - 净充值≤0

总充值: 100.00 USDT
总提现: 550.00 USDT
净充值: -450.00 USDT
历史最高净充值: 500.00 USDT
总资产: 75.00 USDT
累计盈利: 525.00 USDT
盈利率: 52,500% (基于净充值1 USDT计算)
触发时间: 2025-01-16 14:30:25

---
请及时关注该用户交易行为</pre>
    </div>

  </div>

  <!-- Vue & Element UI JS -->
  <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script>
    new Vue({
      el: '#app',
      data: {
        globalTab: 'prototype',
        menuOpen: {
          notify: true
        },
        addingGroupId: null,
        editingTierId: null,
        newTierForm: {
          minNetDeposit: null,
          maxNetDeposit: null,
          alertProfitRate: null,
          status: 1
        },
        recordDialogVisible: false,
        currentTier: null,
        // 筛选条件
        filterForm: {
          uid: '',
          minProfitRate: null,
          maxProfitRate: null,
          startDate: '',
          endDate: ''
        },
        // 分页
        currentPage: 1,
        pageSize: 20,
        pageSizes: [10, 20, 50, 100],
        allTriggerRecords: [
          // 小额 - 净充值≤0 的触发记录
          { id: 1, tierId: 1, uid: '123456', tierName: '小额 - 净充值≤0', netDeposit: -450.00, maxNetDeposit: 500.00, totalAssets: 75.00, totalProfit: 525.00, profitRate: 52500, alertTime: '2025-01-16 14:30:25' },
          { id: 2, tierId: 1, uid: '789012', tierName: '小额 - 净充值≤0', netDeposit: -200.00, maxNetDeposit: 300.00, totalAssets: 50.00, totalProfit: 250.00, profitRate: 25000, alertTime: '2025-01-16 13:20:15' },
          { id: 3, tierId: 1, uid: '345678', tierName: '小额 - 净充值≤0', netDeposit: -100.00, maxNetDeposit: 200.00, totalAssets: 80.00, totalProfit: 180.00, profitRate: 18000, alertTime: '2025-01-15 16:45:30' },
          // 小额 - 净充值0-50USDT 的触发记录
          { id: 4, tierId: 2, uid: '111111', tierName: '小额 - 净充值0-50USDT', netDeposit: 45.50, maxNetDeposit: 45.50, totalAssets: 273.00, totalProfit: 227.50, profitRate: 500.00, alertTime: '2025-01-16 13:15:10' },
          { id: 5, tierId: 2, uid: '222222', tierName: '小额 - 净充值0-50USDT', netDeposit: 30.00, maxNetDeposit: 50.00, totalAssets: 180.00, totalProfit: 150.00, profitRate: 500.00, alertTime: '2025-01-16 12:30:45' },
          { id: 6, tierId: 2, uid: '333333', tierName: '小额 - 净充值0-50USDT', netDeposit: 25.00, maxNetDeposit: 40.00, totalAssets: 150.00, totalProfit: 125.00, profitRate: 500.00, alertTime: '2025-01-15 18:20:30' },
          // 中额 - 净充值50-100USDT 的触发记录
          { id: 7, tierId: 3, uid: '121212', tierName: '中额 - 净充值50-100USDT', netDeposit: 80.00, maxNetDeposit: 120.00, totalAssets: 440.00, totalProfit: 360.00, profitRate: 450.00, alertTime: '2025-01-16 12:05:33' },
          { id: 8, tierId: 3, uid: '131313', tierName: '中额 - 净充值50-100USDT', netDeposit: 75.00, maxNetDeposit: 100.00, totalAssets: 412.50, totalProfit: 337.50, profitRate: 450.00, alertTime: '2025-01-15 15:30:20' },
          // 中额 - 净充值100-200USDT 的触发记录
          { id: 9, tierId: 4, uid: '212121', tierName: '中额 - 净充值100-200USDT', netDeposit: 150.00, maxNetDeposit: 150.00, totalAssets: 750.00, totalProfit: 600.00, profitRate: 400.00, alertTime: '2025-01-16 10:15:45' },
          { id: 10, tierId: 4, uid: '222222', tierName: '中额 - 净充值100-200USDT', netDeposit: 120.00, maxNetDeposit: 180.00, totalAssets: 600.00, totalProfit: 480.00, profitRate: 400.00, alertTime: '2025-01-15 14:20:10' },
          // 大额 - 净充值200-500USDT 的触发记录
          { id: 11, tierId: 5, uid: '313131', tierName: '大额 - 净充值200-500USDT', netDeposit: 300.00, maxNetDeposit: 300.00, totalAssets: 1350.00, totalProfit: 1050.00, profitRate: 350.00, alertTime: '2025-01-16 11:20:45' },
          { id: 12, tierId: 5, uid: '323232', tierName: '大额 - 净充值200-500USDT', netDeposit: 250.00, maxNetDeposit: 400.00, totalAssets: 1125.00, totalProfit: 875.00, profitRate: 350.00, alertTime: '2025-01-15 13:45:20' },
          // 大额 - 净充值500+USDT 的触发记录
          { id: 13, tierId: 6, uid: '414141', tierName: '大额 - 净充值500+USDT', netDeposit: 800.00, maxNetDeposit: 800.00, totalAssets: 3200.00, totalProfit: 2400.00, profitRate: 300.00, alertTime: '2025-01-16 09:30:15' },
          { id: 14, tierId: 6, uid: '424242', tierName: '大额 - 净充值500+USDT', netDeposit: 600.00, maxNetDeposit: 1000.00, totalAssets: 2400.00, totalProfit: 1800.00, profitRate: 300.00, alertTime: '2025-01-15 11:15:30' }
        ],
        tiers: [
          { id: 1, groupId: '1', groupName: '小额净充值盈利预警群', tierName: '小额 - 净充值≤0', minNetDeposit: -999999, maxNetDeposit: 0, alertProfitRate: 5000, status: 1, createdAt: '2025-01-10', triggerCount: 12, userCount: 8, triggerUsers: ['123456', '789012', '345678', '901234', '567890', '234567', '890123', '456789'] },
          { id: 2, groupId: '1', groupName: '小额净充值盈利预警群', tierName: '小额 - 净充值0-50USDT', minNetDeposit: 0, maxNetDeposit: 50, alertProfitRate: 500, status: 1, createdAt: '2025-01-10', triggerCount: 45, userCount: 23, triggerUsers: ['111111', '222222', '333333', '444444', '555555', '666666', '777777', '888888', '999999', '101010'] },
          { id: 3, groupId: '2', groupName: '中额净充值盈利预警群', tierName: '中额 - 净充值50-100USDT', minNetDeposit: 50, maxNetDeposit: 100, alertProfitRate: 450, status: 1, createdAt: '2025-01-11', triggerCount: 28, userCount: 15, triggerUsers: ['121212', '131313', '141414', '151515', '161616', '171717', '181818', '191919', '202020'] },
          { id: 4, groupId: '2', groupName: '中额净充值盈利预警群', tierName: '中额 - 净充值100-200USDT', minNetDeposit: 100, maxNetDeposit: 200, alertProfitRate: 400, status: 1, createdAt: '2025-01-11', triggerCount: 18, userCount: 10, triggerUsers: ['212121', '222222', '232323', '242424', '252525'] },
          { id: 5, groupId: '3', groupName: '大额净充值盈利预警群', tierName: '大额 - 净充值200-500USDT', minNetDeposit: 200, maxNetDeposit: 500, alertProfitRate: 350, status: 1, createdAt: '2025-01-12', triggerCount: 15, userCount: 9, triggerUsers: ['313131', '323232', '333333', '343434', '353535'] },
          { id: 6, groupId: '3', groupName: '大额净充值盈利预警群', tierName: '大额 - 净充值500-999999USDT', minNetDeposit: 500, maxNetDeposit: 999999, alertProfitRate: 300, status: 1, createdAt: '2025-01-12', triggerCount: 8, userCount: 5, triggerUsers: ['414141', '424242', '434343'] }
        ]
      },
      computed: {
        smallTiers() {
          return this.tiers.filter(t => t.groupId === '1').sort((a, b) => a.minNetDeposit - b.minNetDeposit);
        },
        mediumTiers() {
          return this.tiers.filter(t => t.groupId === '2').sort((a, b) => a.minNetDeposit - b.minNetDeposit);
        },
        largeTiers() {
          return this.tiers.filter(t => t.groupId === '3').sort((a, b) => a.minNetDeposit - b.minNetDeposit);
        },
        currentTierRecords() {
          if (!this.currentTier) return [];
          return this.allTriggerRecords.filter(r => r.tierId === this.currentTier.id);
        },
        // 筛选后的记录
        filteredRecords() {
          let records = this.currentTierRecords;

          // UID 筛选
          if (this.filterForm.uid) {
            records = records.filter(r => r.uid.includes(this.filterForm.uid));
          }

          // 盈利率范围筛选
          if (this.filterForm.minProfitRate !== null && this.filterForm.minProfitRate !== '') {
            records = records.filter(r => r.profitRate >= this.filterForm.minProfitRate);
          }
          if (this.filterForm.maxProfitRate !== null && this.filterForm.maxProfitRate !== '') {
            records = records.filter(r => r.profitRate <= this.filterForm.maxProfitRate);
          }

          // 时间范围筛选
          if (this.filterForm.startDate) {
            records = records.filter(r => r.alertTime >= this.filterForm.startDate);
          }
          if (this.filterForm.endDate) {
            records = records.filter(r => r.alertTime <= this.filterForm.endDate + ' 23:59:59');
          }

          return records;
        },
        // 分页后的记录
        pagedRecords() {
          const start = (this.currentPage - 1) * this.pageSize;
          const end = start + this.pageSize;
          return this.filteredRecords.slice(start, end);
        },
        uniqueUserCount() {
          if (!this.currentTierRecords.length) return 0;
          const uniqueUsers = new Set(this.currentTierRecords.map(r => r.uid));
          return uniqueUsers.size;
        },
        totalRecords() {
          return this.filteredRecords.length;
        }
      },
      methods: {
        toggleMenu(menuName) {
          this.menuOpen[menuName] = !this.menuOpen[menuName];
        },
        startAddTier(groupId) {
          this.addingGroupId = groupId;
          this.newTierForm = { minNetDeposit: null, maxNetDeposit: null, alertProfitRate: null, status: 1 };
        },
        cancelAddTier() {
          this.addingGroupId = null;
          this.newTierForm = { minNetDeposit: null, maxNetDeposit: null, alertProfitRate: null, status: 1 };
        },
        saveNewTier(groupId) {
          // 校验
          if (this.newTierForm.minNetDeposit === null || this.newTierForm.minNetDeposit === '') {
            this.$message.error('请填写最小净充值');
            return;
          }
          if (this.newTierForm.maxNetDeposit === null || this.newTierForm.maxNetDeposit === '') {
            this.$message.error('请填写最大净充值');
            return;
          }
          if (!this.newTierForm.alertProfitRate) {
            this.$message.error('请填写预警盈利率');
            return;
          }
          if (this.newTierForm.minNetDeposit >= this.newTierForm.maxNetDeposit) {
            this.$message.error('最小净充值必须小于最大净充值');
            return;
          }

          // 检查区间重叠
          const overlapTier = this.tiers.find(tier => {
            return this.newTierForm.minNetDeposit < tier.maxNetDeposit &&
                   tier.minNetDeposit < this.newTierForm.maxNetDeposit;
          });

          if (overlapTier) {
            this.$message.error('该区间与其他区间重叠');
            return;
          }

          // 生成档位名称
          const groupMap = { '1': '小额', '2': '中额', '3': '大额' };
          const groupName = groupMap[groupId];
          let rangeDesc = '';
          if (this.newTierForm.minNetDeposit <= 0 && this.newTierForm.maxNetDeposit === 0) {
            rangeDesc = '净充值≤0';
          } else {
            rangeDesc = `净充值${this.newTierForm.minNetDeposit}-${this.newTierForm.maxNetDeposit}USDT`;
          }
          const tierName = `${groupName} - ${rangeDesc}`;

          // 添加新档位
          const newTier = {
            id: Math.max(...this.tiers.map(t => t.id), 0) + 1,
            groupId: groupId,
            groupName: { '1': '小额净充值盈利预警群', '2': '中额净充值盈利预警群', '3': '大额净充值盈利预警群' }[groupId],
            tierName: tierName,
            minNetDeposit: this.newTierForm.minNetDeposit,
            maxNetDeposit: this.newTierForm.maxNetDeposit,
            alertProfitRate: this.newTierForm.alertProfitRate,
            status: this.newTierForm.status,
            createdAt: new Date().toISOString().split('T')[0],
            triggerCount: 0,
            userCount: 0,
            triggerUsers: []
          };

          this.tiers.push(newTier);
          this.$message.success('档位添加成功');
          this.cancelAddTier();
        },
        editTier(tier) {
          // 关闭新增表单
          this.addingGroupId = null;
          // 进入编辑模式
          this.editingTierId = tier.id;
          // 填充表单数据
          this.newTierForm = {
            minNetDeposit: tier.minNetDeposit,
            maxNetDeposit: tier.maxNetDeposit,
            alertProfitRate: tier.alertProfitRate,
            status: tier.status
          };
        },
        saveEdit() {
          // 校验
          if (this.newTierForm.minNetDeposit === null || this.newTierForm.minNetDeposit === '') {
            this.$message.error('请填写最小净充值');
            return;
          }
          if (this.newTierForm.maxNetDeposit === null || this.newTierForm.maxNetDeposit === '') {
            this.$message.error('请填写最大净充值');
            return;
          }
          if (!this.newTierForm.alertProfitRate) {
            this.$message.error('请填写预警盈利率');
            return;
          }
          if (this.newTierForm.minNetDeposit >= this.newTierForm.maxNetDeposit) {
            this.$message.error('最小净充值必须小于最大净充值');
            return;
          }

          // 找到要编辑的档位
          const tier = this.tiers.find(t => t.id === this.editingTierId);
          if (!tier) {
            this.$message.error('档位不存在');
            return;
          }

          // 检查区间是否与其他档位重叠（排除自己）
          const overlapping = this.tiers.some(t =>
            t.id !== this.editingTierId &&
            t.groupId === tier.groupId &&
            !(this.newTierForm.maxNetDeposit <= t.minNetDeposit || this.newTierForm.minNetDeposit >= t.maxNetDeposit)
          );
          if (overlapping) {
            this.$message.error('该区间与其他区间重叠');
            return;
          }

          // 生成档位名称
          const groupMap = { '1': '小额', '2': '中额', '3': '大额' };
          const groupName = groupMap[tier.groupId];
          let rangeDesc = '';
          if (this.newTierForm.minNetDeposit <= 0 && this.newTierForm.maxNetDeposit === 0) {
            rangeDesc = '净充值≤0';
          } else {
            rangeDesc = `净充值${this.newTierForm.minNetDeposit}-${this.newTierForm.maxNetDeposit}USDT`;
          }
          const tierName = `${groupName} - ${rangeDesc}`;

          // 更新档位
          tier.tierName = tierName;
          tier.minNetDeposit = this.newTierForm.minNetDeposit;
          tier.maxNetDeposit = this.newTierForm.maxNetDeposit;
          tier.alertProfitRate = this.newTierForm.alertProfitRate;
          tier.status = this.newTierForm.status;

          this.$message.success('档位更新成功');
          this.cancelEdit();
        },
        cancelEdit() {
          this.editingTierId = null;
          this.newTierForm = { minNetDeposit: null, maxNetDeposit: null, alertProfitRate: null, status: 1 };
        },
        deleteTier(tier) {
          this.$confirm('确定要删除该档位吗?', '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(() => {
            this.tiers = this.tiers.filter(t => t.id !== tier.id);
            this.$message.success('删除成功');
          }).catch(() => {
            this.$message.info('已取消删除');
          });
        },
        viewTriggerRecords(tier) {
          this.currentTier = tier;
          this.recordDialogVisible = true;
          this.resetFilter();
        },
        resetFilter() {
          this.filterForm = {
            uid: '',
            minProfitRate: null,
            maxProfitRate: null,
            startDate: '',
            endDate: ''
          };
          this.currentPage = 1;
        },
        handlePageChange(page) {
          this.currentPage = page;
        },
        handleSizeChange(size) {
          this.pageSize = size;
          this.currentPage = 1;
        }
      }
    });
  </script>
</body>
</html>

