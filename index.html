<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>盈利率预警系统 - 高保真原型</title>
  <!-- Element UI CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif;
      background-color: #f0f2f5;
      overflow: hidden;
    }
    /* 全局顶部导航 */
    .global-header {
      height: 60px;
      background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      padding: 0 30px;
      color: #fff;
    }
    .global-header-title {
      font-size: 20px;
      font-weight: bold;
      margin-right: 50px;
    }
    .global-nav {
      display: flex;
      gap: 5px;
    }
    .global-nav-item {
      padding: 8px 20px;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.3s;
      font-size: 14px;
    }
    .global-nav-item:hover {
      background-color: rgba(255,255,255,0.2);
    }
    .global-nav-item.active {
      background-color: rgba(255,255,255,0.3);
      font-weight: bold;
    }
    .layout-container {
      display: flex;
      height: calc(100vh - 60px);
    }
    /* 左侧菜单 */
    .sidebar {
      width: 200px;
      background-color: #304156;
      color: #fff;
      overflow-y: auto;
    }
    .sidebar-header {
      height: 50px;
      line-height: 50px;
      text-align: center;
      font-size: 16px;
      font-weight: bold;
      background-color: #1f2d3d;
      border-bottom: 1px solid #1f2d3d;
    }
    .menu-group {
      margin-top: 10px;
    }
    .menu-group-title {
      padding: 10px 20px;
      font-size: 12px;
      color: #8c939d;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .menu-group-title:hover {
      background-color: #263445;
    }
    .menu-item {
      padding: 12px 20px 12px 40px;
      font-size: 14px;
      color: #bfcbd9;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
    }
    .menu-item:hover {
      background-color: #263445;
      color: #fff;
    }
    .menu-item.active {
      background-color: #1890ff;
      color: #fff;
    }
    .menu-item i {
      margin-right: 8px;
      font-size: 16px;
    }
    .submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .submenu.open {
      max-height: 500px;
    }
    /* 主内容区 */
    .main-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }
    /* 文档内容样式 */
    .doc-container {
      max-width: 1200px;
      margin: 0 auto;
      background: #fff;
      padding: 40px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .doc-container h1 {
      font-size: 28px;
      margin-bottom: 20px;
      border-bottom: 2px solid #1890ff;
      padding-bottom: 10px;
    }
    .doc-container h2 {
      font-size: 22px;
      margin-top: 30px;
      margin-bottom: 15px;
      color: #1890ff;
    }
    .doc-container h3 {
      font-size: 18px;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .doc-container pre {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .doc-container table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    .doc-container table th,
    .doc-container table td {
      border: 1px solid #e8e8e8;
      padding: 10px;
      text-align: left;
    }
    .doc-container table th {
      background: #fafafa;
      font-weight: bold;
    }
    .doc-container ul, .doc-container ol {
      margin: 10px 0;
      padding-left: 30px;
    }
    .doc-container li {
      margin: 5px 0;
    }
    .page-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .page-title {
      font-size: 20px;
      font-weight: 500;
      color: #303133;
      margin-bottom: 20px;
      padding-left: 10px;
      border-left: 3px solid #1890ff;
    }
    .app-container {
      background: #fff;
      padding: 20px;
      border-radius: 4px;
      box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
      margin-bottom: 30px;
    }
    .head-container {
      margin-bottom: 20px;
    }
    .filter-item {
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .el-form-item-label {
      font-weight: 700;
      color: #606266;
      padding-right: 12px;
    }
    .dialog-footer {
      text-align: right;
    }

    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .tab-content {
      flex: 1;
      overflow-y: auto;
      padding: 40px;
      background: #fff;
      width: 100%;
      height: calc(100vh - 60px);
    }

    .tab-content h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #303133;
    }

    .tab-content h2 {
      font-size: 18px;
      margin-top: 20px;
      margin-bottom: 15px;
      color: #606266;
    }

    .tab-content h3 {
      font-size: 16px;
      margin-top: 15px;
      margin-bottom: 10px;
      color: #909399;
    }

    .tab-content p {
      margin-bottom: 10px;
      line-height: 1.6;
      color: #606266;
    }

    .tab-content ul {
      margin-left: 20px;
      margin-bottom: 10px;
    }

    .tab-content li {
      margin-bottom: 8px;
      line-height: 1.6;
      color: #606266;
    }

    .tab-content pre {
      background-color: #f5f7fa;
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      margin-bottom: 10px;
      font-size: 12px;
      line-height: 1.5;
    }

    .tab-content table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }

    .tab-content table th,
    .tab-content table td {
      border: 1px solid #dfe6ec;
      padding: 10px;
      text-align: left;
    }

    .tab-content table th {
      background-color: #f5f7fa;
      font-weight: bold;
    }

    .tier-group-header {
      background-color: #f5f7fa;
      padding: 10px;
      font-weight: bold;
      color: #303133;
    }
    /* 模拟 Element UI 表格样式 */
    .el-table {
      width: 100%;
      border: 1px solid #dfe6ec;
    }
    .el-table th {
      background-color: #f5f7fa;
      color: #606266;
      font-weight: 500;
      padding: 12px 0;
      text-align: center;
      border-bottom: 1px solid #dfe6ec;
    }
    .el-table td {
      padding: 12px 0;
      text-align: center;
      border-bottom: 1px solid #dfe6ec;
    }
    .el-table tr:hover {
      background-color: #f5f7fa;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- 全局顶部导航 -->
    <div class="global-header">
      <div class="global-header-title">盈利率预警系统</div>
      <div class="global-nav">
        <div class="global-nav-item" :class="{ active: globalTab === 'prototype' }" @click="globalTab = 'prototype'">
          原型
        </div>
        <div class="global-nav-item" :class="{ active: globalTab === 'prd' }" @click="globalTab = 'prd'">
          产品文档
        </div>
        <div class="global-nav-item" :class="{ active: globalTab === 'frontend' }" @click="globalTab = 'frontend'">
          前端规范
        </div>
        <div class="global-nav-item" :class="{ active: globalTab === 'template' }" @click="globalTab = 'template'">
          群通知模板
        </div>
      </div>
    </div>

    <div class="layout-container" v-show="globalTab === 'prototype'">
      <!-- 左侧菜单 -->
      <div class="sidebar">
        <div class="sidebar-header">BITDU Admin</div>

        <!-- 通知管理 -->
        <div class="menu-group">
          <div class="menu-group-title" @click="toggleMenu('notify')">
            <span><i class="el-icon-message"></i> 通知管理</span>
            <i :class="menuOpen.notify ? 'el-icon-arrow-down' : 'el-icon-arrow-right'"></i>
          </div>
          <div class="submenu" :class="{ open: menuOpen.notify }">
            <div class="menu-item" @click="currentPage = 'tier'" :class="{ active: currentPage === 'tier' }">
              <i class="el-icon-setting"></i>
              盈利率预警档位配置
            </div>
          </div>
        </div>

        <!-- 风控管理 -->
        <div class="menu-group">
          <div class="menu-group-title" @click="toggleMenu('risk')">
            <span><i class="el-icon-warning"></i> 风控管理</span>
            <i :class="menuOpen.risk ? 'el-icon-arrow-down' : 'el-icon-arrow-right'"></i>
          </div>
          <div class="submenu" :class="{ open: menuOpen.risk }">
            <div class="menu-item" @click="currentPage = 'record'" :class="{ active: currentPage === 'record' }">
              <i class="el-icon-document"></i>
              盈利率预警记录
            </div>
          </div>
        </div>
      </div>

      <!-- 主内容区 -->
      <div class="main-container">
        <div class="page-container">

          <!-- ==================== 4.2 档位管理 ==================== -->
          <div v-show="currentPage === 'tier'">
            <h1 class="page-title">盈利率预警档位配置</h1>
      
      <div class="app-container">
        <!-- 工具栏 -->
        <div class="head-container">
          <div style="margin-bottom: 15px;">
            <label class="el-form-item-label">所属群组</label>
            <el-select v-model="tierQuery.groupId" clearable placeholder="所属群组" style="width: 200px" class="filter-item">
              <el-option label="小额净充值盈利预警群" value="1"></el-option>
              <el-option label="中额净充值盈利预警群" value="2"></el-option>
              <el-option label="大额净充值盈利预警群" value="3"></el-option>
            </el-select>
            
            <label class="el-form-item-label">状态</label>
            <el-select v-model="tierQuery.status" clearable placeholder="状态" style="width: 150px" class="filter-item">
              <el-option label="开启" value="1"></el-option>
              <el-option label="关闭" value="0"></el-option>
            </el-select>
            
            <el-button class="filter-item" size="mini" type="success" icon="el-icon-search">搜索</el-button>
            <el-button class="filter-item" size="mini" type="warning" icon="el-icon-refresh-left">重置</el-button>
          </div>
          
          <div>
            <el-button class="filter-item" size="mini" type="primary" icon="el-icon-plus" @click="openTierDialog">新增档位</el-button>
          </div>
        </div>

        <!-- 表格 -->
        <el-table :data="sortedTierTableData" size="small" style="width: 100%">
          <el-table-column prop="groupName" label="所属群组" width="200"></el-table-column>
          <el-table-column prop="tierName" label="档位名称" width="300"></el-table-column>
          <el-table-column prop="minNetDeposit" label="最小净充值(USDT)" width="180" align="right"></el-table-column>
          <el-table-column prop="maxNetDeposit" label="最大净充值(USDT)" width="180" align="right"></el-table-column>
          <el-table-column prop="alertProfitRate" label="预警盈利率(%)" width="150" align="right">
            <template slot-scope="scope">
              {{ scope.row.alertProfitRate }}%
            </template>
          </el-table-column>
          <el-table-column prop="status" label="状态" width="100">
            <template slot-scope="scope">
              <el-tag :type="scope.row.status === 1 ? 'success' : 'info'" size="small">
                {{ scope.row.status === 1 ? '开启' : '关闭' }}
              </el-tag>
            </template>
          </el-table-column>
          <el-table-column label="操作" width="150" align="center">
            <template slot-scope="scope">
              <el-button size="mini" type="text" icon="el-icon-edit" @click="editTier(scope.row)">编辑</el-button>
              <el-button size="mini" type="text" icon="el-icon-delete" style="color: #f56c6c;" @click="deleteTier(scope.row)">删除</el-button>
            </template>
          </el-table-column>
        </el-table>

        <!-- 分页 -->
        <el-pagination
          style="margin-top: 20px; text-align: right;"
          @size-change="handleSizeChange"
          @current-change="handleCurrentChange"
          :current-page="tierPage.current"
          :page-sizes="[10, 20, 50, 100]"
          :page-size="tierPage.size"
          layout="total, sizes, prev, pager, next, jumper"
          :total="tierPage.total">
        </el-pagination>
      </div>

      <!-- 新增/编辑档位对话框 -->
      <el-dialog title="新增档位" :visible.sync="tierDialogVisible" width="600px">
        <el-form :model="tierForm" label-width="150px" size="small">
          <el-form-item label="所属群组" required>
            <el-select v-model="tierForm.groupId" placeholder="请选择群组" style="width: 100%;">
              <el-option label="小额净充值盈利预警群" value="1"></el-option>
              <el-option label="中额净充值盈利预警群" value="2"></el-option>
              <el-option label="大额净充值盈利预警群" value="3"></el-option>
            </el-select>
          </el-form-item>
          <el-form-item label="档位名称">
            <el-input :value="generatedTierName" disabled style="width: 100%;"></el-input>
            <div style="color: #909399; font-size: 12px; margin-top: 5px;">
              提示: 档位名称由系统自动生成
            </div>
          </el-form-item>
          <el-form-item label="最小净充值(USDT)" required>
            <el-input-number v-model="tierForm.minNetDeposit" :precision="2" :step="1" style="width: 100%;"></el-input-number>
            <div style="color: #909399; font-size: 12px; margin-top: 5px;">
              提示: 大于等于该值。可以输入负数,如 -999999 表示无下限
            </div>
          </el-form-item>
          <el-form-item label="最大净充值(USDT)" required>
            <el-input-number v-model="tierForm.maxNetDeposit" :precision="2" :step="1" style="width: 100%;"></el-input-number>
            <div style="color: #909399; font-size: 12px; margin-top: 5px;">
              提示: 小于该值(不包含该值)
            </div>
          </el-form-item>
          <el-form-item label="预警盈利率(%)" required>
            <el-input-number v-model="tierForm.alertProfitRate" :precision="2" :step="10" :min="0" style="width: 100%;"></el-input-number>
            <div style="color: #909399; font-size: 12px; margin-top: 5px;">
              提示: 净充值≤0的档位建议设置较高阈值
            </div>
          </el-form-item>
          <el-form-item label="状态" required>
            <el-radio-group v-model="tierForm.status">
              <el-radio :label="1">开启</el-radio>
              <el-radio :label="0">关闭</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
          <el-button @click="tierDialogVisible = false">取消</el-button>
          <el-button type="primary" @click="saveTier">确认</el-button>
        </div>
      </el-dialog>

          </div>

          <!-- ==================== 4.3 盈利率预警记录 ==================== -->
          <div v-show="currentPage === 'record'">
            <h1 class="page-title">盈利率预警记录</h1>
      
      <div class="app-container">
        <!-- 工具栏 -->
        <div class="head-container">
          <div style="margin-bottom: 15px;">
            <label class="el-form-item-label">用户UID</label>
            <el-input v-model="recordQuery.uid" clearable placeholder="用户UID" style="width: 185px" class="filter-item"></el-input>

            <label class="el-form-item-label">档位</label>
            <el-select v-model="recordQuery.tierId" clearable placeholder="档位" style="width: 250px" class="filter-item">
              <el-option label="小额 - 净充值1-50USDT" value="1"></el-option>
              <el-option label="小额 - 净充值≤0" value="2"></el-option>
              <el-option label="中额 - 净充值50-100USDT" value="3"></el-option>
            </el-select>

            <label class="el-form-item-label">报警时间</label>
            <el-date-picker
              v-model="recordQuery.dateRange"
              type="daterange"
              range-separator="至"
              start-placeholder="开始日期"
              end-placeholder="结束日期"
              style="width: 350px"
              class="filter-item">
            </el-date-picker>
          </div>

          <div style="margin-bottom: 15px;">
            <label class="el-form-item-label">盈利率范围(%)</label>
            <el-input v-model="recordQuery.minProfitRate" clearable placeholder="最小盈利率" style="width: 140px" class="filter-item"></el-input>
            <span style="margin: 0 5px;">-</span>
            <el-input v-model="recordQuery.maxProfitRate" clearable placeholder="最大盈利率" style="width: 140px" class="filter-item"></el-input>

            <label class="el-form-item-label" style="margin-left: 15px;">净充值范围(USDT)</label>
            <el-input v-model="recordQuery.minNetDeposit" clearable placeholder="最小净充值" style="width: 140px" class="filter-item"></el-input>
            <span style="margin: 0 5px;">-</span>
            <el-input v-model="recordQuery.maxNetDeposit" clearable placeholder="最大净充值" style="width: 140px" class="filter-item"></el-input>

            <el-button class="filter-item" size="mini" type="success" icon="el-icon-search" style="margin-left: 15px;">搜索</el-button>
            <el-button class="filter-item" size="mini" type="warning" icon="el-icon-refresh-left">重置</el-button>
            <el-button class="filter-item" size="mini" type="primary" icon="el-icon-download">导出</el-button>
          </div>
        </div>

        <!-- 表格 -->
        <el-table :data="recordTableData" size="small" style="width: 100%">
          <el-table-column prop="uid" label="用户UID" width="120"></el-table-column>
          <el-table-column prop="tierName" label="档位名称" width="250"></el-table-column>
          <el-table-column prop="netDeposit" label="净充值(USDT)" width="140" align="right"></el-table-column>
          <el-table-column prop="maxNetDeposit" label="历史最高净充值(USDT)" width="180" align="right"></el-table-column>
          <el-table-column prop="totalAssets" label="总资产(USDT)" width="140" align="right"></el-table-column>
          <el-table-column prop="totalProfit" label="累计盈利(USDT)" width="140" align="right"></el-table-column>
          <el-table-column prop="profitRate" label="盈利率(%)" width="120" align="right">
            <template slot-scope="scope">
              {{ scope.row.profitRate }}%
            </template>
          </el-table-column>
          <el-table-column prop="alertTime" label="报警时间" width="180"></el-table-column>
        </el-table>

        <!-- 分页 -->
        <el-pagination
          style="margin-top: 20px; text-align: right;"
          @size-change="handleRecordSizeChange"
          @current-change="handleRecordCurrentChange"
          :current-page="recordPage.current"
          :page-sizes="[10, 20, 50, 100]"
          :page-size="recordPage.size"
          layout="total, sizes, prev, pager, next, jumper"
          :total="recordPage.total">
        </el-pagination>
      </div>

          </div>

        </div>
      </div>

    </div>

    <!-- 产品文档标签页 -->
    <div class="tab-content" v-show="globalTab === 'prd'">
      
      <h1>产品需求文档(PRD)</h1>
      <h2>净充值盈利率预警系统</h2>

      <h3>一、需求背景</h3>

      <p><strong>提出方</strong>: 市场部</p>
      <p><strong>需求描述</strong>: 需要在 Telegram 设立三个群组,分别监控小额、中额、大额净充值用户的盈利情况,当用户盈利率达到预设阈值时,自动向对应群组发送预警消息。</p>

      <p><strong>业务目标</strong>:</p>
      <ul>
        <li>实时监控高盈利用户,及时发现异常交易行为</li>
        <li>按净充值金额分层管理,提高监控效率</li>
        <li>按盈利率预警</li>
        <li>通过 Telegram 群组通知,便于团队协作处理</li>
      </ul>

      <hr>

      <h3>二、核心概念定义</h3>

      <h4>2.1 净充值</h4>
      <p>复用已有公式</p>

      <h4>2.2 历史最高净充值 ⭐ 新增字段</h4>
      <pre>
历史最高净充值 = 用户历史上净充值的最大值
</pre>

      <p><strong>更新时机</strong>:</p>
      <ul>
        <li>每次用户发生充值或提现行为时(包括链上充值、链上提现、法币入金等),重新计算当前净充值</li>
        <li>若当前净充值 > 历史最高净充值,则更新历史最高净充值</li>
        <li>该字段只增不减,记录用户曾经达到过的最高本金水平</li>
      </ul>


      <h4>2.3 总资产</h4>
      <p>复用已有公式</p>

      <h4>2.4 累计盈利</h4>
      <pre>
累计盈利 = 总资产 - 净充值
</pre>

      <p><strong>说明</strong>:</p>
      <ul>
        <li>当净充值为负数时,累计盈利 = 总资产 - 负数 = 总资产 + |净充值|</li>
      </ul>

      <h4>2.5 盈利率 ⭐ 核心公式</h4>

      <pre>
if (净充值 <= 0) {
    盈利率 = (累计盈利 / 1) × 100%
} else {
    盈利率 = (累计盈利 / 净充值) × 100%
}
</pre>

      <p><strong>边界情况处理</strong>:</p>
      <ul>
        <li>当 `净充值 <= 0` 时: <strong>统一按净充值 = 1 USDT 计算</strong></li>
      </ul>
      <hr>

      <h3>三、功能需求</h3>

      <h4>3.1 群组配置</h4>

      <p><strong>需求</strong>: 支持配置多个 Telegram 预警群组</p>

      <table>
        <tr>
          <th>字段</th>
          <th>说明</th>
          <th>示例</th>
        </tr>
        <tr>
          <td>群组名称</td>
          <td>群组的业务名称</td>
          <td>"小额净充值盈利预警群"</td>
        </tr>
        <tr>
          <td>通知类型标识</td>
          <td>系统内部标识</td>
          <td>"profit_alert_small"</td>
        </tr>
        <tr>
          <td>Telegram Webhook URL</td>
          <td>群组的机器人推送地址</td>
          <td>"https://api.telegram.org/bot..."</td>
        </tr>
        <tr>
          <td>状态</td>
          <td>启用/禁用</td>
          <td>启用</td>
        </tr>
      </table>

      <p><strong>固定配置</strong>:</p>
      <ul>
        <li>小额净充值盈利预警群</li>
        <li>中额净充值盈利预警群</li>
        <li>大额净充值盈利预警群</li>
      </ul>

      <p><strong>说明</strong>: 具体的净充值金额区间、盈利率阈值等参数,由市场部在 Admin 后台的"档位配置"中自行设定</p>

      <h4>3.2 档位配置</h4>

      <p><strong>需求</strong>: 每个群组可配置多个盈利率预警档位</p>

      <table>
        <tr>
          <th>字段</th>
          <th>说明</th>
          <th>示例</th>
          <th>必填</th>
        </tr>
        <tr>
          <td>所属群组</td>
          <td>关联的群组</td>
          <td>"小额净充值盈利预警群"</td>
          <td>是</td>
        </tr>
        <tr>
          <td>档位名称</td>
          <td>系统自动生成,格式: "群组简称 - 净充值区间"</td>
          <td>"小额 - 净充值1-50USDT"</td>
          <td>自动</td>
        </tr>
        <tr>
          <td>最小净充值</td>
          <td>净充值下限(USDT),可为负数</td>
          <td>1 或 -999999</td>
          <td>是</td>
        </tr>
        <tr>
          <td>最大净充值</td>
          <td>净充值上限(USDT)</td>
          <td>50</td>
          <td>是</td>
        </tr>
        <tr>
          <td>预警盈利率</td>
          <td>触发预警的盈利率(%)</td>
          <td>500</td>
          <td>是</td>
        </tr>
        <tr>
          <td>状态</td>
          <td>启用/禁用</td>
          <td>启用</td>
          <td>是</td>
        </tr>
      </table>

      <p><strong>档位名称生成规则</strong>:</p>
      <ul>
        <li>格式: `{群组简称} - 净充值{区间描述}`</li>
        <li>群组简称: "小额净充值盈利预警群" → "小额", "中额净充值盈利预警群" → "中额", "大额净充值盈利预警群" → "大额"</li>
        <li>区间描述:</li>
      </ul>
      <p>- 最小 ≤ 0 且 最大 = 0: "净充值≤0"</p>
      <p>- 最小 ≥ 0 且 最大 < 999999: "净充值{最小}-{最大}USDT"</p>
      <p>- 最大 ≥ 999999: "净充值{最小}+USDT"</p>

      <p><strong>配置说明</strong>:</p>
      <ul>
        <li>每个群组可配置多个档位</li>
        <li>档位名称由系统自动生成,无需手动输入</li>
        <li>配置项: 所属群组、最小净充值、最大净充值、预警盈利率、状态</li>
      </ul>

      <h4>3.3 触发机制</h4>

      <p><strong>触发时机</strong>:</p>
      <ul>
        <li>用户<strong>合约平仓</strong>时</li>
        <li>用户<strong>现货卖出成交</strong>时</li>
      </ul>

      <p><strong>触发逻辑</strong>:</p>
      <p>1. 计算用户当前的净充值、总资产、累计盈利、盈利率</p>
      <p>3. 查找所有启用的档位配置</p>
      <p>4. 匹配用户净充值所在的档位区间</p>
      <p>5. 判断盈利率是否 >= 档位的预警盈利率</p>
      <p>6. 检查该用户在该档位当日是否已报警过(防重复)</p>
      <p>7. 若满足条件且未报警,则发送 Telegram 通知并记录</p>

      <p><strong>防重复机制</strong>:</p>
      <ul>
        <li>同一用户在同一档位每日只报警一次</li>
        <li>若用户净充值变化导致进入新档位,可再次报警</li>
        <li>通过 `profit_alert_record` 表记录已报警的用户+档位组合</li>
      </ul>

      <h4>3.4 Telegram 通知内容</h4>

      <p><strong>消息格式(正常用户)</strong>:</p>
      <pre>
⚠️ 盈利率预警 ⚠️

用户UID: 123456
档位: 小额 - 净充值1-50USDT

总充值: 100.00 USDT
总提现: 0.00 USDT
净充值: 100.00 USDT
历史最高净充值: 100.00 USDT
总资产: 500.00 USDT
累计盈利: 400.00 USDT
盈利率: 400.00%
触发时间: 2025-01-16 14:30:25

---
请及时关注该用户交易行为
</pre>

      <p><strong>消息格式(负净充值用户)</strong> ⚠️:</p>
      <pre>
⚠️⚠️ 盈利率预警(异常盈利) ⚠️⚠️

用户UID: 123456
档位: 小额 - 净充值≤0

总充值: 100.00 USDT
总提现: 550.00 USDT
净充值: -450.00 USDT
历史最高净充值: 500.00 USDT
总资产: 75.00 USDT
累计盈利: 525.00 USDT
盈利率: 52,500% (基于净充值1 USDT计算)
触发时间: 2025-01-16 14:30:25

---
请及时关注该用户交易行为
</pre>

      <h4>3.5 报警记录查询</h4>

      <p><strong>需求</strong>: Admin 后台可查询历史报警记录</p>

      <p><strong>查询条件</strong>:</p>
      <ul>
        <li>用户 UID</li>
        <li>档位</li>
        <li>报警时间范围</li>
        <li>盈利率范围</li>
        <li>净充值范围</li>
      </ul>

      <p><strong>列表字段</strong>:</p>
      <ul>
        <li>用户 UID</li>
        <li>档位名称</li>
        <li>净充值</li>
        <li>历史最高净充值</li>
        <li>总资产</li>
        <li>累计盈利</li>
        <li>盈利率</li>
        <li>报警时间</li>
      </ul>



      <hr>

      <h3>四、Admin 后台功能</h3>

      <h4>4.1 群组管理</h4>
      <ul>
        <li><strong>配置位置</strong>: 复用现有的"群组通知机器人管理"模块</li>
        <li><strong>数据表</strong>: `group_notify_bot` (群组通知机器人表,已存在)</li>
        <li><strong>列表页</strong>: 展示所有群组,支持启用/禁用</li>
        <li><strong>新增/编辑</strong>: 配置群组名称、通知类型、Telegram URL</li>
        <li><strong>删除</strong>: 删除群组(需确认,关联档位一并删除)</li>
      </ul>

      <h4>4.2 档位管理</h4>
      <ul>
        <li><strong>配置位置</strong>: Admin 后台"通知管理 > 群通知"菜单下新增"盈利率预警档位配置"</li>
        <li><strong>数据表</strong>: `profit_alert_tier` (盈利率预警档位表)</li>
        <li><strong>列表页</strong>: 按群组分组展示档位,支持启用/禁用</li>
        <li><strong>排序规则</strong>: 按最小净充值从小到大排序(负数在前,正数在后)</li>
        <li><strong>新增/编辑</strong>: 配置净充值区间、预警盈利率</li>
      </ul>
      <p>- 支持配置负数的最小净充值(如 -999999 表示无下限)</p>
      <p>- 示例: 最小净充值 = -999999, 最大净充值 = 0, 表示"净充值 ≤ 0"</p>
      <ul>
        <li><strong>删除</strong>: 删除档位(需确认)</li>
        <li><strong>校验</strong>:</li>
      </ul>
      <p>- <strong>最小净充值必须 < 最大净充值</strong></p>
      <p>- <strong>所有档位(包括不同群组)的净充值区间不能重叠</strong></p>
      <p>- 重叠判断: <code>新档位最小值 < 已有档位最大值 && 已有档位最小值 < 新档位最大值</code></p>
      <p>- 如果重叠,提示"该区间与其他区间重叠",拒绝保存</p>

      <h4>4.3 盈利率预警记录查询</h4>
      <ul>
        <li><strong>配置位置</strong>: Admin 后台"风控管理 > 盈利用户监控"菜单下</li>
        <li><strong>数据表</strong>: `profit_alert_record` (盈利率预警记录表)</li>
        <li><strong>列表页</strong>: 展示历史报警记录</li>
      </ul>
      <p></p>
      <ul>
        <li><strong>筛选</strong>: 支持按用户、档位、时间、净充值范围筛选</li>
        <li><strong>导出</strong>: </li>
        <li><strong>详情</strong>: 点击记录可查看完整的财务数据快照</li>
      </ul>

      <hr>

      <h3>五、业务规则</h3>

      <h4>5.1 档位匹配规则</h4>
      <ul>
        <li>用户净充值在 `[最小净充值, 最大净充值)` 区间内(左闭右开)</li>
      </ul>
      <p>- 即: <code>最小净充值 <= 用户净充值 < 最大净充值</code></p>
      <p>- 包含最小值,不包含最大值</p>
      <p>- 示例: 档位配置为 [50, 100),则 50 USDT 匹配,100 USDT 不匹配</p>
      <ul>
        <li><strong>所有档位(包括不同群组)的净充值区间不允许重叠</strong></li>
      </ul>
      <p>- 这确保了每个用户只会匹配到唯一一个档位</p>
      <p>- 不同群组之间通过净充值区间自然划分(小额、中额、大额)</p>
      <ul>
        <li><strong>特殊</strong>: 净充值 ≤ 0 的用户,归入"小额群组"的特殊档位</li>
      </ul>

      <h4>5.2 防重复规则</h4>
      <ul>
        <li>同一用户 + 同一档位,只报警一次(通过数据库唯一索引保证)</li>
        <li>若用户净充值变化,进入新档位,可再次报警</li>
        <li>若档位配置修改(如盈利率阈值降低),不会重新报警已报警用户</li>
      </ul>

      <h4>5.3 边界情况</h4>
      <ul>
        <li><strong>净充值 ≤ 0</strong>: 按 1 USDT 计算盈利率,盈利率会非常高(预期行为)</li>
        <li><strong>禁用状态的群组或档位</strong>: 不触发报警</li>
      </ul>

      <hr>

      <h3>六、验收标准</h3>

      <h4>6.1 功能验收</h4>
      <ul>
        <li>☐ Admin 后台可正常配置群组和档位(包括负数净充值档位)</li>
        <li>☐ 用户平仓/卖出后,系统能正确计算盈利率</li>
        <li>☐ 净充值 > 0 的用户,盈利率计算正确</li>
        <li>☐ 净充值 ≤ 0 的用户,盈利率按 1 USDT 计算</li>
        <li>☐ 总资产 ≤ 0 的用户不触发预警</li>
        <li>☐ 达到阈值时,Telegram 群组能收到通知</li>
        <li>☐ 负净充值用户的通知有特殊标记</li>
        <li>☐ 同一用户同一档位不会重复报警</li>
        <li>☐ 报警记录可在 Admin 后台查询</li>
      </ul>

      <h4>6.2 数据验收</h4>
      <ul>
        <li>☐ 净充值计算准确(与财务统计一致)</li>
        <li>☐ 总资产计算准确(包含所有钱包和未实现盈亏)</li>
        <li>☐ 盈利率计算准确(边界情况处理正确)</li>
        <li>☐ 负净充值用户的盈利率计算符合预期</li>
      </ul>

      <h4>6.3 边界测试用例</h4>
      <pre>
测试用例1: 净充值为0
- 总充值: 100, 总提现: 100, 净充值: 0
- 总资产: 50
- 预期盈利率: 5000% (50/1×100%)

测试用例2: 净充值为负数
- 总充值: 100, 总提现: 200, 净充值: -100
- 总资产: 80
- 预期盈利率: 18000% (180/1×100%)

测试用例4: 正常用户
- 总充值: 100, 总提现: 0, 净充值: 100
- 总资产: 500
- 预期盈利率: 400% (400/100×100%)
</pre>

      <hr>

      <h3>七、关键决策记录</h3>

      <table>
        <tr>
          <th>决策点</th>
          <th>方案</th>
          <th>理由</th>
        </tr>
        <tr>
          <td>净充值 ≤ 0 如何计算盈利率</td>
          <td>按 1 USDT 计算</td>
          <td>识别"本金提走仍盈利"的异常用户</td>
        </tr>
        <tr>
          <td>盈利率虚高是否正常</td>
          <td>正常,这是预期行为</td>
          <td>通过高阈值过滤,只抓最异常的</td>
        </tr>
        <tr>
          <td>负净充值用户归入哪个群组</td>
          <td>小额群组</td>
          <td>简化设计,符合"三个群"需求</td>
        </tr>
        <tr>
          <td>触发时机</td>
          <td>合约平仓/现货卖出</td>
          <td>参考现有"下单预警"功能</td>
        </tr>
      </table>

      <hr>



    
    </div>

    <!-- 前端规范标签页 -->
    <div class="tab-content" v-show="globalTab === 'frontend'">
      <h1>前端开发规范</h1>
      <h2>一、技术栈</h2>
      <ul>
        <li>Vue.js 2.x</li>
        <li>Element UI</li>
        <li>Axios (HTTP请求)</li>
        <li>CRUD Mixin模式</li>
      </ul>

      <h2>二、页面结构</h2>
      <h3>1. 档位管理页面</h3>
      <p>路径: src/views/profitAlert/tier/index.vue</p>
      <ul>
        <li>筛选区: 所属群组、状态</li>
        <li>操作按钮: 搜索、重置、新增档位</li>
        <li>表格: 展示档位列表,按最小净充值排序</li>
        <li>操作列: 编辑、删除</li>
        <li>对话框: 新增/编辑档位</li>
      </ul>

      <h3>2. 预警记录页面</h3>
      <p>路径: src/views/profitAlert/record/index.vue</p>
      <ul>
        <li>筛选区: 用户UID、档位、报警时间范围</li>
        <li>操作按钮: 搜索、重置、导出</li>
        <li>表格: 展示预警记录</li>
      </ul>

      <h2>三、关键字段处理</h2>
      <h3>1. 档位名称自动生成</h3>
      <p>档位名称由系统自动生成,无需手动输入。格式为: 群组简称 - 净充值区间</p>

      <h3>2. 区间重叠校验</h3>
      <p>保存时必须校验所有档位(包括不同群组)的净充值区间是否重叠。</p>

      <h3>3. 表格排序</h3>
      <p>表格默认按最小净充值从小到大排序。</p>

      <h2>四、API接口</h2>
      <h3>档位管理</h3>
      <ul>
        <li>GET /api/profit-alert/tier/list - 查询档位列表</li>
        <li>POST /api/profit-alert/tier/save - 新增/编辑档位</li>
        <li>DELETE /api/profit-alert/tier/delete - 删除档位</li>
      </ul>

      <h3>预警记录</h3>
      <ul>
        <li>GET /api/profit-alert/record/list - 查询预警记录</li>
        <li>GET /api/profit-alert/record/export - 导出预警记录</li>
      </ul>
    </div>

    <!-- 群通知模板标签页 -->
    <div class="tab-content" v-show="globalTab === 'template'">
      <h1>Telegram群通知模板</h1>
      <h2>一、预警消息模板</h2>
      <pre>🚨 盈利率预警

用户UID: {member_id}
档位: {tier_name}
净充值: {net_deposit} USDT
历史最高净充值: {max_net_deposit} USDT
总资产: {total_assets} USDT
累计盈利: {total_profit} USDT
盈利率: {profit_rate}%
报警时间: {alert_time}</pre>

      <h2>二、消息示例</h2>
      <h3>示例1: 正常盈利用户</h3>
      <pre>🚨 盈利率预警

用户UID: 100234
档位: 小额 - 净充值1-50USDT
净充值: 30 USDT
历史最高净充值: 50 USDT
总资产: 180 USDT
累计盈利: 150 USDT
盈利率: 500%
报警时间: 2025-01-16 14:30:25</pre>

      <h3>示例2: 负净充值用户(重点关注)</h3>
      <pre>🚨 盈利率预警

用户UID: 100567
档位: 小额 - 净充值≤0
净充值: -350 USDT
历史最高净充值: 100 USDT
总资产: 50 USDT
累计盈利: 400 USDT
盈利率: 40000%
报警时间: 2025-01-16 15:45:10</pre>

      <h3>示例3: 大额用户</h3>
      <pre>🚨 盈利率预警

用户UID: 100789
档位: 大额 - 净充值500+USDT
净充值: 1000 USDT
历史最高净充值: 2000 USDT
总资产: 4500 USDT
累计盈利: 3500 USDT
盈利率: 350%
报警时间: 2025-01-16 16:20:33</pre>

      <h2>三、后端实现要点</h2>
      <h3>1. 消息发送</h3>
      <p>使用 SendBotMessageService 发送消息到对应的 Telegram 群组。</p>

      <h3>2. 数字格式化</h3>
      <ul>
        <li>金额保留2位小数</li>
        <li>盈利率保留2位小数</li>
        <li>负数正常显示,不需要特殊处理</li>
      </ul>

      <h2>四、群组配置</h2>
      <p>在"通知管理 > 群通知"中配置三个群组的Bot Token和Chat ID,确保消息能正常发送到对应的Telegram群。</p>
    </div>

  </div>

  <!-- Vue & Element UI JS -->
  <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script>
    new Vue({
      el: '#app',
      data: {
        // 全局标签页
        globalTab: 'prototype', // 'prototype', 'prd', 'frontend', 'template'

        // 当前页面
        currentPage: 'tier', // 'tier' 或 'record'

        // 菜单展开状态
        menuOpen: {
          notify: true,
          risk: false
        },



        // 档位管理
        tierQuery: {
          groupId: '',
          status: ''
        },
        tierTableData: [
          { id: 1, groupName: '小额净充值盈利预警群', tierName: '净充值≤0,盈利率5000%', minNetDeposit: -999999, maxNetDeposit: 0, alertProfitRate: 5000, status: 1 },
          { id: 2, groupName: '小额净充值盈利预警群', tierName: '净充值0-50USDT,盈利率500%', minNetDeposit: 0, maxNetDeposit: 50, alertProfitRate: 500, status: 1 },
          { id: 3, groupName: '中额净充值盈利预警群', tierName: '净充值50-100USDT,盈利率450%', minNetDeposit: 50, maxNetDeposit: 100, alertProfitRate: 450, status: 1 },
          { id: 4, groupName: '中额净充值盈利预警群', tierName: '净充值100-200USDT,盈利率400%', minNetDeposit: 100, maxNetDeposit: 200, alertProfitRate: 400, status: 1 },
          { id: 5, groupName: '大额净充值盈利预警群', tierName: '净充值200-500USDT,盈利率350%', minNetDeposit: 200, maxNetDeposit: 500, alertProfitRate: 350, status: 1 },
          { id: 6, groupName: '大额净充值盈利预警群', tierName: '净充值500+USDT,盈利率300%', minNetDeposit: 500, maxNetDeposit: 999999, alertProfitRate: 300, status: 1 },
        ],
        tierPage: {
          current: 1,
          size: 10,
          total: 6
        },
        tierDialogVisible: false,
        tierForm: {
          groupId: '',
          minNetDeposit: null,
          maxNetDeposit: null,
          alertProfitRate: 0,
          status: 1
        },
        
        // 预警记录
        recordQuery: {
          uid: '',
          tierId: '',
          dateRange: null,
          minProfitRate: '',
          maxProfitRate: '',
          minNetDeposit: '',
          maxNetDeposit: ''
        },
        recordTableData: [
          { id: 1, uid: '123456', tierName: '小额 - 净充值≤0', netDeposit: -450.00, maxNetDeposit: 500.00, totalAssets: 75.00, totalProfit: 525.00, profitRate: 52500, alertTime: '2025-01-16 14:30:25' },
          { id: 2, uid: '789012', tierName: '小额 - 净充值1-50USDT', netDeposit: 45.50, maxNetDeposit: 45.50, totalAssets: 273.00, totalProfit: 227.50, profitRate: 500.00, alertTime: '2025-01-16 13:15:10' },
          { id: 3, uid: '345678', tierName: '中额 - 净充值50-100USDT', netDeposit: 80.00, maxNetDeposit: 120.00, totalAssets: 440.00, totalProfit: 360.00, profitRate: 450.00, alertTime: '2025-01-16 12:05:33' },
          { id: 4, uid: '901234', tierName: '大额 - 净充值200-500USDT', netDeposit: 300.00, maxNetDeposit: 300.00, totalAssets: 1350.00, totalProfit: 1050.00, profitRate: 350.00, alertTime: '2025-01-16 11:20:45' },
        ],
        recordPage: {
          current: 1,
          size: 10,
          total: 4
        }
      },
      computed: {
        // 按最小净充值从小到大排序
        sortedTierTableData() {
          return [...this.tierTableData].sort((a, b) => a.minNetDeposit - b.minNetDeposit);
        },

        // 自动生成档位名称
        generatedTierName() {
          if (!this.tierForm.groupId || this.tierForm.minNetDeposit === null || this.tierForm.maxNetDeposit === null) {
            return '请先选择群组并填写净充值区间';
          }

          // 群组简称映射
          const groupNameMap = {
            '1': '小额',
            '2': '中额',
            '3': '大额'
          };

          const groupShortName = groupNameMap[this.tierForm.groupId] || '';
          const min = this.tierForm.minNetDeposit;
          const max = this.tierForm.maxNetDeposit;

          let rangeDesc = '';
          if (min <= 0 && max === 0) {
            rangeDesc = '净充值≤0';
          } else if (max >= 999999) {
            rangeDesc = `净充值${min}+USDT`;
          } else {
            rangeDesc = `净充值${min}-${max}USDT`;
          }

          return `${groupShortName} - ${rangeDesc}`;
        }
      },
      methods: {
        // 切换菜单展开/收起
        toggleMenu(menuName) {
          this.menuOpen[menuName] = !this.menuOpen[menuName];
        },

        handleSizeChange(val) {
          this.tierPage.size = val;
        },
        handleCurrentChange(val) {
          this.tierPage.current = val;
        },
        handleRecordSizeChange(val) {
          this.recordPage.size = val;
        },
        handleRecordCurrentChange(val) {
          this.recordPage.current = val;
        },
        openTierDialog() {
          this.tierForm = {
            groupId: '',
            minNetDeposit: null,
            maxNetDeposit: null,
            alertProfitRate: 0,
            status: 1
          };
          this.tierDialogVisible = true;
        },
        editTier(row) {
          this.tierForm = { ...row };
          this.tierDialogVisible = true;
        },
        deleteTier(row) {
          this.$confirm('确定要删除该档位吗?', '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(() => {
            this.$message.success('删除成功!');
          }).catch(() => {
            this.$message.info('已取消删除');
          });
        },

        saveTier() {
          // 校验必填项
          if (!this.tierForm.groupId) {
            this.$message.error('请选择所属群组');
            return;
          }
          if (this.tierForm.minNetDeposit === null || this.tierForm.minNetDeposit === '') {
            this.$message.error('请填写最小净充值');
            return;
          }
          if (this.tierForm.maxNetDeposit === null || this.tierForm.maxNetDeposit === '') {
            this.$message.error('请填写最大净充值');
            return;
          }
          if (!this.tierForm.alertProfitRate) {
            this.$message.error('请填写预警盈利率');
            return;
          }

          // 校验最小值必须小于最大值
          if (this.tierForm.minNetDeposit >= this.tierForm.maxNetDeposit) {
            this.$message.error('最小净充值必须小于最大净充值!');
            return;
          }

          // 校验区间是否与已有档位重叠(包括不同群组)
          const overlapTier = this.tierTableData.find(tier => {
            // 编辑时排除自己
            if (tier.id === this.tierForm.id) return false;

            // 检查区间重叠: [min1, max1) 和 [min2, max2) 重叠的条件是 min1 < max2 && min2 < max1
            return this.tierForm.minNetDeposit < tier.maxNetDeposit &&
                   tier.minNetDeposit < this.tierForm.maxNetDeposit;
          });

          if (overlapTier) {
            this.$message.error('该区间与其他区间重叠');
            return;
          }

          // 保存成功
          this.$message.success('保存成功!');
          this.tierDialogVisible = false;
        }
      }
    });
  </script>
</body>
</html>
